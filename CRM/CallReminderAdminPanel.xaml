<Window x:Class="Kalendarz1.CRM.CallReminderAdminPanel"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:Kalendarz1.CRM"
        Title="Panel administracyjny - Przypomnienia" Height="700" Width="1100"
        WindowStartupLocation="CenterScreen" WindowStyle="None" AllowsTransparency="True"
        Background="Transparent" ResizeMode="CanResize" MinWidth="800" MinHeight="400">

    <Window.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/CRM/Styles/GlassStyles.xaml"/>
            </ResourceDictionary.MergedDictionaries>
            <local:InverseLengthToVisibilityConverter x:Key="InverseLengthToVisibility"/>
            <local:StringToBrushConverter x:Key="StringToBrush"/>
            <local:StringToColorConverter x:Key="StringToColor"/>
            <BooleanToVisibilityConverter x:Key="BoolToVisibility"/>
        </ResourceDictionary>
    </Window.Resources>

    <Border Background="#0d1117" CornerRadius="12" BorderBrush="#252530" BorderThickness="1">
        <Grid>
            <!-- Title bar for dragging -->
            <Border Height="32" VerticalAlignment="Top" Background="Transparent"
                    MouseLeftButtonDown="Header_MouseLeftButtonDown">
                <Grid Margin="12,0">
                    <TextBlock Text="Panel administracyjny" FontSize="12" Foreground="#66FFFFFF" VerticalAlignment="Center"/>
                    <Button HorizontalAlignment="Right" Content="X" FontSize="12" Foreground="#66FFFFFF"
                            Style="{StaticResource GlassButton}" Padding="8,2" Click="BtnClose_Click"/>
                </Grid>
            </Border>

            <!-- Decorative glow -->
            <Ellipse Width="300" Height="300" HorizontalAlignment="Left" VerticalAlignment="Top" Margin="-100,-100,0,0" Opacity="0.15">
                <Ellipse.Fill>
                    <RadialGradientBrush>
                        <GradientStop Color="#3fb950" Offset="0"/>
                        <GradientStop Color="Transparent" Offset="1"/>
                    </RadialGradientBrush>
                </Ellipse.Fill>
                <Ellipse.Effect><BlurEffect Radius="100"/></Ellipse.Effect>
            </Ellipse>

            <Grid Margin="12,36,12,8">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>  <!-- 0: Stats bar -->
                    <RowDefinition Height="Auto"/>  <!-- 1: Search + Sort + Filters -->
                    <RowDefinition Height="*"/>     <!-- 2: Main Table -->
                    <RowDefinition Height="Auto"/>  <!-- 3: Bottom Bar -->
                </Grid.RowDefinitions>

                <!-- ============================================ -->
                <!-- STATS BAR                                     -->
                <!-- ============================================ -->
                <Border Grid.Row="0" Background="#18181f" BorderBrush="#252530"
                        BorderThickness="1" CornerRadius="8" Padding="0" Margin="0,0,0,4">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- Calls Today -->
                        <StackPanel Grid.Column="0" Orientation="Horizontal" Margin="12,6">
                            <Grid Width="20" Height="20" Margin="0,0,6,0">
                                <Border CornerRadius="5" Background="#1A3fb950"/>
                                <Path Fill="#3fb950" Stretch="Uniform" Width="10" Height="10"
                                      HorizontalAlignment="Center" VerticalAlignment="Center"
                                      Data="M6.62,10.79C8.06,13.62 10.38,15.94 13.21,17.38L15.41,15.18C15.69,14.9 16.08,14.82 16.43,14.93C17.55,15.3 18.75,15.5 20,15.5C20.55,15.5 21,15.95 21,16.5V20C21,20.55 20.55,21 20,21C10.61,21 3,13.39 3,4C3,3.45 3.45,3 4,3H7.5C8.05,3 8.5,3.45 8.5,4C8.5,5.25 8.7,6.45 9.07,7.57C9.18,7.92 9.1,8.31 8.82,8.59L6.62,10.79Z"/>
                            </Grid>
                            <TextBlock x:Name="txtStatsDzis" Text="0" FontSize="14" FontWeight="Bold" Foreground="#3fb950" VerticalAlignment="Center"/>
                            <TextBlock Text=" dzis" FontSize="9" Foreground="#55FFFFFF" VerticalAlignment="Center"/>
                        </StackPanel>

                        <Border Grid.Column="1" Width="1" Background="#252530"/>

                        <!-- Active Agents -->
                        <StackPanel Grid.Column="2" Orientation="Horizontal" Margin="12,6">
                            <TextBlock x:Name="txtStatsAgents" Text="0/0" FontSize="14" FontWeight="Bold" Foreground="#58a6ff" VerticalAlignment="Center"/>
                            <TextBlock Text=" aktywnych" FontSize="9" Foreground="#55FFFFFF" VerticalAlignment="Center"/>
                        </StackPanel>

                        <Border Grid.Column="3" Width="1" Background="#252530"/>

                        <!-- Week -->
                        <StackPanel Grid.Column="4" Orientation="Horizontal" Margin="12,6">
                            <TextBlock x:Name="txtStatsTydzien" Text="0" FontSize="14" FontWeight="Bold" Foreground="#f59e0b" VerticalAlignment="Center"/>
                            <TextBlock Text=" tydzien" FontSize="9" Foreground="#55FFFFFF" VerticalAlignment="Center"/>
                        </StackPanel>

                        <Border Grid.Column="5" Width="1" Background="#252530"/>

                        <!-- Top performer -->
                        <StackPanel Grid.Column="6" Orientation="Horizontal" Margin="12,6">
                            <TextBlock x:Name="txtTopPerformer" Text="TOP: --" FontSize="11" FontWeight="SemiBold" Foreground="#a78bfa" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- ============================================ -->
                <!-- SEARCH + SORT + FILTERS                      -->
                <!-- ============================================ -->
                <Border Grid.Row="1" Background="#10FFFFFF" BorderBrush="#14FFFFFF"
                        BorderThickness="1" CornerRadius="8" Padding="8,3" Margin="0,0,0,4">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <Path Fill="#55FFFFFF" Stretch="Uniform" Width="12" Height="12"
                              VerticalAlignment="Center" Margin="0,0,6,0"
                              Data="M15.5,14h-0.79l-0.28-0.27C15.41,12.59,16,11.11,16,9.5C16,5.91,13.09,3,9.5,3S3,5.91,3,9.5S5.91,16,9.5,16 c1.61,0,3.09-0.59,4.23-1.57l0.27,0.28v0.79l5,4.99L20.49,19L15.5,14z M9.5,14C7.01,14,5,11.99,5,9.5S7.01,5,9.5,5 S14,7.01,14,9.5S11.99,14,9.5,14z"/>
                        <TextBox x:Name="txtSearchHandlowiec" Grid.Column="1"
                                 Background="Transparent" BorderThickness="0"
                                 Foreground="White" FontSize="12" CaretBrush="White"
                                 VerticalAlignment="Center"
                                 TextChanged="TxtSearchHandlowiec_TextChanged"/>
                        <TextBlock Grid.Column="1" Text="Szukaj handlowca..." FontSize="12"
                                   Foreground="#44FFFFFF" VerticalAlignment="Center"
                                   IsHitTestVisible="False"
                                   Visibility="{Binding Text.Length, ElementName=txtSearchHandlowiec, Converter={StaticResource InverseLengthToVisibility}}"/>
                        <TextBlock x:Name="txtSearchCount" Grid.Column="2" Text="" FontSize="10"
                                   Foreground="#55FFFFFF" VerticalAlignment="Center" Margin="6,0"/>

                        <ComboBox x:Name="cmbSort" Grid.Column="3" Width="120" FontSize="10"
                                  Style="{StaticResource GlassComboBox}"
                                  SelectionChanged="CmbSort_SelectionChanged"
                                  SelectedIndex="0">
                            <ComboBoxItem Content="Aktywnosc"/>
                            <ComboBoxItem Content="Nazwa A-Z"/>
                            <ComboBoxItem Content="Wyniki dzis"/>
                            <ComboBoxItem Content="Wyniki tydzien"/>
                        </ComboBox>

                        <CheckBox x:Name="chkOnlyActive" Grid.Column="4" Content="Tylko aktywni"
                                  Style="{StaticResource GlassCheckBox}" FontSize="10" Foreground="#88FFFFFF"
                                  Margin="8,0,0,0" Checked="ChkOnlyActive_Changed" Unchecked="ChkOnlyActive_Changed"/>
                    </Grid>
                </Border>

                <!-- ============================================ -->
                <!-- MAIN TABLE                                    -->
                <!-- ============================================ -->
                <Border Grid.Row="2" Background="#0C0C12" BorderBrush="#1E1E2A"
                        BorderThickness="1" CornerRadius="8" ClipToBounds="True">
                    <DataGrid x:Name="dgHandlowcy" AutoGenerateColumns="False"
                              Background="Transparent" BorderThickness="0"
                              GridLinesVisibility="Horizontal"
                              HorizontalGridLinesBrush="#0EFFFFFF"
                              RowBackground="Transparent"
                              AlternatingRowBackground="Transparent"
                              HeadersVisibility="Column"
                              SelectionMode="Single"
                              SelectionUnit="FullRow"
                              CanUserAddRows="False"
                              CanUserDeleteRows="False"
                              CanUserReorderColumns="False"
                              CanUserResizeRows="False"
                              RowHeight="68"
                              ColumnHeaderHeight="32"
                              Foreground="White"
                              FontSize="12"
                              HorizontalScrollBarVisibility="Disabled"
                              VerticalScrollBarVisibility="Auto">

                        <DataGrid.ColumnHeaderStyle>
                            <Style TargetType="DataGridColumnHeader">
                                <Setter Property="Background" Value="#0A0A10"/>
                                <Setter Property="Foreground" Value="#8899AA"/>
                                <Setter Property="FontSize" Value="10"/>
                                <Setter Property="FontWeight" Value="SemiBold"/>
                                <Setter Property="Padding" Value="10,6"/>
                                <Setter Property="BorderBrush" Value="#14FFFFFF"/>
                                <Setter Property="BorderThickness" Value="0,0,0,1"/>
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="DataGridColumnHeader">
                                            <Border Background="{TemplateBinding Background}"
                                                    BorderBrush="{TemplateBinding BorderBrush}"
                                                    BorderThickness="{TemplateBinding BorderThickness}"
                                                    Padding="{TemplateBinding Padding}">
                                                <TextBlock Text="{TemplateBinding Content}"
                                                           Foreground="{TemplateBinding Foreground}"
                                                           FontSize="{TemplateBinding FontSize}"
                                                           FontWeight="{TemplateBinding FontWeight}"
                                                           VerticalAlignment="Center"/>
                                            </Border>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </DataGrid.ColumnHeaderStyle>

                        <DataGrid.RowStyle>
                            <Style TargetType="DataGridRow">
                                <Setter Property="Opacity" Value="{Binding RowOpacity}"/>
                                <Setter Property="Cursor" Value="Hand"/>
                                <Style.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter Property="Background" Value="#08FFFFFF"/>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </DataGrid.RowStyle>

                        <DataGrid.CellStyle>
                            <Style TargetType="DataGridCell">
                                <Setter Property="BorderThickness" Value="0"/>
                                <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
                                <Setter Property="Padding" Value="6,0"/>
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="DataGridCell">
                                            <Border Background="Transparent" Padding="{TemplateBinding Padding}">
                                                <ContentPresenter VerticalAlignment="Center"/>
                                            </Border>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </DataGrid.CellStyle>

                        <DataGrid.Columns>
                            <!-- Status indicator -->
                            <DataGridTemplateColumn Header="" Width="6" CanUserResize="False">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Border Width="4" CornerRadius="2" Margin="0,8">
                                            <Border.Background>
                                                <SolidColorBrush Color="{Binding RowBorderColor, Converter={StaticResource StringToColor}}"/>
                                            </Border.Background>
                                        </Border>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>

                            <!-- Handlowiec - Avatar + Name + Status -->
                            <DataGridTemplateColumn Header="HANDLOWIEC" Width="*" MinWidth="220">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                            <Grid Width="36" Height="36">
                                                <Border Width="36" Height="36" CornerRadius="18"
                                                        Visibility="{Binding HasNoAvatar, Converter={StaticResource BoolToVisibility}}">
                                                    <Border.Background>
                                                        <SolidColorBrush Color="{Binding AvatarColor}"/>
                                                    </Border.Background>
                                                    <TextBlock Text="{Binding Initials}" FontSize="12" FontWeight="Bold"
                                                               Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                </Border>
                                                <Border Width="36" Height="36" CornerRadius="18"
                                                        Visibility="{Binding HasAvatar, Converter={StaticResource BoolToVisibility}}">
                                                    <Border.Background>
                                                        <ImageBrush ImageSource="{Binding AvatarSource}" Stretch="UniformToFill"/>
                                                    </Border.Background>
                                                </Border>
                                                <Ellipse Width="10" Height="10"
                                                         HorizontalAlignment="Right" VerticalAlignment="Bottom"
                                                         Stroke="#0C0C12" StrokeThickness="2"
                                                         Visibility="{Binding IsEnabled, Converter={StaticResource BoolToVisibility}}">
                                                    <Ellipse.Fill><SolidColorBrush Color="#3fb950"/></Ellipse.Fill>
                                                </Ellipse>
                                            </Grid>
                                            <StackPanel Margin="8,0,0,0" VerticalAlignment="Center">
                                                <TextBlock Text="{Binding UserName}" FontSize="13" FontWeight="SemiBold" Foreground="White"/>
                                                <StackPanel Orientation="Horizontal">
                                                    <Border CornerRadius="3" Padding="5,1" Margin="0,2,4,0">
                                                        <Border.Background>
                                                            <SolidColorBrush Color="{Binding StatusColor, Converter={StaticResource StringToColor}}" Opacity="0.15"/>
                                                        </Border.Background>
                                                        <TextBlock Text="{Binding StatusBadge}" FontSize="8" FontWeight="Bold"
                                                                   Foreground="{Binding StatusColor, Converter={StaticResource StringToBrush}}"/>
                                                    </Border>
                                                    <TextBlock Text="{Binding WojewodztwaShort}" FontSize="9" Foreground="#55FFFFFF" VerticalAlignment="Center"/>
                                                </StackPanel>
                                            </StackPanel>
                                        </StackPanel>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>

                            <!-- Schedule -->
                            <DataGridTemplateColumn Header="GODZINY" Width="100">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <StackPanel VerticalAlignment="Center">
                                            <TextBlock FontSize="12" Foreground="#B3FFFFFF">
                                                <Run Text="{Binding Time1String, Mode=OneWay}"/>
                                                <Run Text=","/>
                                                <Run Text="{Binding Time2String, Mode=OneWay}"/>
                                            </TextBlock>
                                            <TextBlock FontSize="9" Foreground="#55FFFFFF">
                                                <Run Text="{Binding ContactsPerReminder, Mode=OneWay}"/>
                                                <Run Text=" kont."/>
                                            </TextBlock>
                                        </StackPanel>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>

                            <!-- Goals + Progress -->
                            <DataGridTemplateColumn Header="CEL DZIS" Width="140">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <StackPanel VerticalAlignment="Center">
                                            <TextBlock Text="{Binding DailyProgressText}" FontSize="11" FontWeight="SemiBold"
                                                       Foreground="{Binding DailyProgressColor, Converter={StaticResource StringToBrush}}"/>
                                            <Grid Margin="0,3,0,0">
                                                <Border Height="4" CornerRadius="2" Background="#252530"/>
                                                <Border Height="4" CornerRadius="2" HorizontalAlignment="Left"
                                                        Width="{Binding DailyProgressPct, Converter={x:Static local:ProgressToWidthHelper.Instance}, ConverterParameter=120}">
                                                    <Border.Background>
                                                        <SolidColorBrush Color="{Binding DailyProgressColor, Converter={StaticResource StringToColor}}"/>
                                                    </Border.Background>
                                                </Border>
                                            </Grid>
                                        </StackPanel>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>

                            <!-- Week calls -->
                            <DataGridTemplateColumn Header="TYDZIEN" Width="80">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding WeekCalls}" FontSize="13" FontWeight="Bold"
                                                   Foreground="#f59e0b" VerticalAlignment="Center"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>

                            <!-- PKD info -->
                            <DataGridTemplateColumn Header="PKD" Width="80">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding PKDSummary}" FontSize="9" Foreground="#55FFFFFF"
                                                   VerticalAlignment="Center" TextWrapping="Wrap"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>

                            <!-- Edit button -->
                            <DataGridTemplateColumn Header="" Width="80">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Button Content="EDYTUJ" Style="{StaticResource GlassButton}"
                                                FontSize="10" FontWeight="SemiBold" Padding="10,4"
                                                Foreground="#58a6ff" Click="BtnEditHandlowiec_Click"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>
                    </DataGrid>
                </Border>

                <!-- ============================================ -->
                <!-- BOTTOM BAR                                    -->
                <!-- ============================================ -->
                <Border Grid.Row="3" Background="#18181f" BorderBrush="#252530"
                        BorderThickness="1" CornerRadius="8" Padding="10,6" Margin="0,4,0,0">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <TextBlock Grid.Column="0" Text="Kliknij EDYTUJ aby skonfigurowac handlowca"
                                   FontSize="10" Foreground="#33FFFFFF" VerticalAlignment="Center"/>

                        <StackPanel Grid.Column="1" Orientation="Horizontal" Margin="16,0">
                            <Button Style="{StaticResource GlassButton}" Margin="0,0,6,0"
                                    Click="BtnImport_Click" Padding="10,5" ToolTip="Import firm z Excel">
                                <StackPanel Orientation="Horizontal">
                                    <Path Fill="#f59e0b" Stretch="Uniform" Width="11" Height="11" VerticalAlignment="Center" Margin="0,0,4,0"
                                          Data="M5,20h14v-2H5V20z M19,9h-4V3H9v6H5l7,7L19,9z"/>
                                    <TextBlock Text="Import" FontSize="10" Foreground="White"/>
                                </StackPanel>
                            </Button>
                            <Button Style="{StaticResource GlassButton}" Margin="0,0,6,0"
                                    Click="BtnTest_Click" Padding="10,5" ToolTip="Testuj przypomnienie">
                                <TextBlock Text="Test" FontSize="10" Foreground="#58a6ff"/>
                            </Button>
                            <Button Style="{StaticResource GlassButton}" Margin="0,0,6,0"
                                    Click="BtnRefresh_Click" Padding="10,5" ToolTip="OdswieÅ¼ dane">
                                <Path Fill="#3fb950" Stretch="Uniform" Width="11" Height="11" VerticalAlignment="Center"
                                      Data="M17.65,6.35C16.2,4.9,14.21,4,12,4c-4.42,0-7.99,3.58-7.99,8s3.57,8,7.99,8c3.73,0,6.84-2.55,7.73-6h-2.08c-0.82,2.33-3.04,4-5.65,4-3.31,0-6-2.69-6-6s2.69-6,6-6c1.66,0,3.14,0.69,4.22,1.78L13,11h7V4L17.65,6.35z"/>
                            </Button>
                        </StackPanel>

                        <Button Grid.Column="2" Style="{StaticResource SuccessButton}" Click="BtnSave_Click" Padding="14,6">
                            <StackPanel Orientation="Horizontal">
                                <Path Fill="White" Stretch="Uniform" Width="11" Height="11" VerticalAlignment="Center" Margin="0,0,6,0"
                                      Data="M17,3H5C3.89,3,3,3.9,3,5v14c0,1.1,0.89,2,2,2h14c1.1,0,2-0.9,2-2V7L17,3z M12,19c-1.66,0-3-1.34-3-3s1.34-3,3-3s3,1.34,3,3S13.66,19,12,19z M15,9H5V5h10V9z"/>
                                <TextBlock Text="Zapisz" FontSize="12" FontWeight="Bold" Foreground="White"/>
                            </StackPanel>
                        </Button>
                    </Grid>
                </Border>
            </Grid>
        </Grid>
    </Border>
</Window>
