<UserControl x:Class="Kalendarz1.WPF.Controls.LoadingOverlay"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             x:Name="loadingControl">

    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis"/>

        <!-- Animacja spinner -->
        <Storyboard x:Key="SpinnerAnimation" RepeatBehavior="Forever">
            <DoubleAnimation Storyboard.TargetName="SpinnerRotate"
                             Storyboard.TargetProperty="Angle"
                             From="0" To="360" Duration="0:0:1"/>
        </Storyboard>
    </UserControl.Resources>

    <Grid Visibility="{Binding IsLoading, ElementName=loadingControl, Converter={StaticResource BoolToVis}}">
        <!-- Tło przyciemnione -->
        <Border Background="#80000000" Opacity="0.7"/>

        <!-- Panel ładowania -->
        <Border Background="White" CornerRadius="12"
                HorizontalAlignment="Center" VerticalAlignment="Center"
                MinWidth="250" Padding="30,25">
            <Border.Effect>
                <DropShadowEffect ShadowDepth="3" Opacity="0.3" BlurRadius="15"/>
            </Border.Effect>

            <StackPanel>
                <!-- Spinner -->
                <Grid Width="50" Height="50" HorizontalAlignment="Center" Margin="0,0,0,15">
                    <Ellipse Stroke="#E0E0E0" StrokeThickness="4"/>
                    <Path Stroke="#3498DB" StrokeThickness="4" StrokeStartLineCap="Round" StrokeEndLineCap="Round">
                        <Path.Data>
                            <PathGeometry>
                                <PathFigure StartPoint="25,2">
                                    <ArcSegment Point="48,25" Size="23,23" SweepDirection="Clockwise"/>
                                </PathFigure>
                            </PathGeometry>
                        </Path.Data>
                        <Path.RenderTransform>
                            <RotateTransform x:Name="SpinnerRotate" CenterX="25" CenterY="25"/>
                        </Path.RenderTransform>
                    </Path>
                </Grid>

                <!-- Tekst ładowania -->
                <TextBlock x:Name="txtMessage"
                           Text="{Binding LoadingMessage, ElementName=loadingControl}"
                           FontSize="14" FontWeight="SemiBold"
                           Foreground="#2C3E50"
                           HorizontalAlignment="Center"
                           TextAlignment="Center"/>

                <!-- Progress bar (opcjonalny) -->
                <ProgressBar x:Name="progressBar"
                             Height="6" Margin="0,15,0,0"
                             Minimum="0" Maximum="100"
                             Value="{Binding Progress, ElementName=loadingControl}"
                             Visibility="{Binding ShowProgress, ElementName=loadingControl, Converter={StaticResource BoolToVis}}"
                             Foreground="#3498DB" Background="#E0E0E0"/>

                <!-- Procent (opcjonalny) -->
                <TextBlock Text="{Binding Progress, ElementName=loadingControl, StringFormat={}{0:0}%}"
                           FontSize="12" Foreground="#7F8C8D"
                           HorizontalAlignment="Center" Margin="0,5,0,0"
                           Visibility="{Binding ShowProgress, ElementName=loadingControl, Converter={StaticResource BoolToVis}}"/>
            </StackPanel>
        </Border>
    </Grid>

    <UserControl.Triggers>
        <EventTrigger RoutedEvent="UserControl.Loaded">
            <BeginStoryboard Storyboard="{StaticResource SpinnerAnimation}"/>
        </EventTrigger>
    </UserControl.Triggers>
</UserControl>
