<UserControl x:Class="Kalendarz1.WPF.Controls.AutoCompleteTextBox"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             x:Name="autoCompleteControl">

    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis"/>

        <Style x:Key="SuggestionItemStyle" TargetType="ListBoxItem">
            <Setter Property="Padding" Value="10,8"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ListBoxItem">
                        <Border x:Name="border" Background="White" Padding="{TemplateBinding Padding}">
                            <ContentPresenter/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#ECF0F1"/>
                            </Trigger>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#3498DB"/>
                                <Setter Property="Foreground" Value="White"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </UserControl.Resources>

    <Grid>
        <!-- TextBox -->
        <TextBox x:Name="txtInput"
                 Text="{Binding Text, ElementName=autoCompleteControl, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                 Padding="10,8"
                 FontSize="13"
                 BorderBrush="#BDC3C7"
                 BorderThickness="1"
                 TextChanged="TxtInput_TextChanged"
                 KeyDown="TxtInput_KeyDown"
                 LostFocus="TxtInput_LostFocus"/>

        <!-- Placeholder -->
        <TextBlock x:Name="txtPlaceholder"
                   Text="{Binding Placeholder, ElementName=autoCompleteControl}"
                   Padding="12,8"
                   FontSize="13"
                   Foreground="#95A5A6"
                   IsHitTestVisible="False"
                   Visibility="Collapsed"/>

        <!-- Popup z sugestiami -->
        <Popup x:Name="popupSuggestions"
               PlacementTarget="{Binding ElementName=txtInput}"
               Placement="Bottom"
               Width="{Binding ActualWidth, ElementName=txtInput}"
               MaxHeight="250"
               StaysOpen="False"
               AllowsTransparency="True">
            <Border Background="White"
                    BorderBrush="#BDC3C7"
                    BorderThickness="1"
                    CornerRadius="0,0,4,4">
                <Border.Effect>
                    <DropShadowEffect ShadowDepth="2" Opacity="0.2" BlurRadius="8"/>
                </Border.Effect>

                <ListBox x:Name="lstSuggestions"
                         BorderThickness="0"
                         ItemContainerStyle="{StaticResource SuggestionItemStyle}"
                         ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                         SelectionChanged="LstSuggestions_SelectionChanged">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <StackPanel>
                                <TextBlock Text="{Binding DisplayText}"
                                           FontWeight="SemiBold"
                                           FontSize="12"/>
                                <TextBlock Text="{Binding SecondaryText}"
                                           FontSize="10"
                                           Foreground="#7F8C8D"
                                           Visibility="{Binding HasSecondaryText, Converter={StaticResource BoolToVis}}"/>
                            </StackPanel>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
            </Border>
        </Popup>

        <!-- Ikona wyszukiwania -->
        <TextBlock Text="ðŸ”"
                   FontSize="14"
                   Foreground="#95A5A6"
                   HorizontalAlignment="Right"
                   VerticalAlignment="Center"
                   Margin="0,0,10,0"
                   IsHitTestVisible="False"/>
    </Grid>
</UserControl>
