<Window x:Class="Kalendarz1.Kartoteka.Views.KartotekaOdbiorcowWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Kartoteka OdbiorcÃ³w - ZPSP"
        Width="1400" Height="900"
        MinWidth="1100" MinHeight="700"
        WindowStartupLocation="CenterScreen"
        WindowState="Maximized"
        KeyDown="Window_KeyDown"
        Loaded="Window_Loaded"
        Closing="Window_Closing">

    <Window.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="../Resources/KartotekaStyles.xaml"/>
            </ResourceDictionary.MergedDictionaries>
        </ResourceDictionary>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="5*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="5*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <!-- NAGÅÃ“WEK -->
        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <Border Grid.Row="0">
            <Border.Background>
                <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                    <GradientStop Color="#166534" Offset="0"/>
                    <GradientStop Color="#059669" Offset="1"/>
                </LinearGradientBrush>
            </Border.Background>
            <Grid Margin="16,10">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Logo -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center" Margin="0,0,16,0">
                    <Border Width="40" Height="40" Background="White" CornerRadius="20" Margin="0,0,8,0">
                        <TextBlock Text="ðŸ”" FontSize="22" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                    </Border>
                    <StackPanel VerticalAlignment="Center">
                        <TextBlock Text="UBOJNIA DROBIU" FontWeight="Bold" Foreground="White" FontSize="10"/>
                        <TextBlock Text="PIÃ“RKOWSCY" Foreground="#A7F3D0" FontSize="9" FontWeight="SemiBold"/>
                    </StackPanel>
                </StackPanel>

                <!-- Separator -->
                <Border Grid.Column="1" Width="1" Background="#40FFFFFF" Margin="8,4" VerticalAlignment="Stretch"/>

                <!-- TytuÅ‚ -->
                <StackPanel Grid.Column="2" VerticalAlignment="Center" Margin="16,0">
                    <TextBlock Text="ðŸ“‹ Kartoteka OdbiorcÃ³w" FontWeight="Bold" FontSize="16" Foreground="White"/>
                    <TextBlock x:Name="TextBlockHandlowiec" Text="Handlowiec:" FontSize="11" Foreground="#A7F3D0"/>
                </StackPanel>

                <!-- Filtry -->
                <StackPanel Grid.Column="3" Orientation="Horizontal" VerticalAlignment="Center" HorizontalAlignment="Left">
                    <TextBox x:Name="TextBoxSzukaj" Width="220"
                             Style="{StaticResource KartotekaSearchBox}"
                             Tag="ðŸ” Szukaj (firma, miasto, NIP)..."
                             TextChanged="TextBoxSzukaj_TextChanged"/>

                    <ComboBox x:Name="ComboBoxKategoria" Width="110" Margin="8,0,0,0"
                              SelectionChanged="ComboBoxKategoria_SelectionChanged">
                        <ComboBoxItem Content="Kategoria" IsSelected="True"/>
                        <ComboBoxItem Content="A"/>
                        <ComboBoxItem Content="B"/>
                        <ComboBoxItem Content="C"/>
                    </ComboBox>

                    <ComboBox x:Name="ComboBoxHandlowiec" Width="130" Margin="8,0,0,0"
                              Visibility="Collapsed"
                              SelectionChanged="ComboBoxHandlowiec_SelectionChanged"/>

                    <CheckBox x:Name="CheckBoxAlerty" Content="âš ï¸ Tylko alerty"
                              Foreground="White" Margin="12,0,0,0"
                              VerticalAlignment="Center"
                              Checked="CheckBoxAlerty_Changed" Unchecked="CheckBoxAlerty_Changed"/>

                    <Button x:Name="ButtonDebug" Content="ðŸ› Debug"
                            Background="#7C3AED" Foreground="White" FontSize="11"
                            Padding="8,4" Margin="12,0,0,0" Cursor="Hand"
                            BorderThickness="0" FontWeight="SemiBold"
                            Click="ButtonDebug_Click"
                            ToolTip="Uruchom test wydajnoÅ›ci Å‚adowania danych"/>
                </StackPanel>

                <!-- Przyciski -->
                <StackPanel Grid.Column="4" Orientation="Horizontal" VerticalAlignment="Center">
                    <Button Content="ðŸ”„ OdÅ›wieÅ¼" Style="{StaticResource KartotekaPrimaryButton}"
                            Click="ButtonOdswiez_Click" Margin="0,0,8,0"/>
                    <Button Content="ðŸ“¥ Excel" Style="{StaticResource KartotekaSecondaryButton}"
                            Click="ButtonExcel_Click"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <!-- LEGENDA ALERTÃ“W -->
        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <Border Grid.Row="1" Background="White" BorderBrush="#E5E7EB" BorderThickness="0,0,0,1" Padding="16,4">
            <StackPanel Orientation="Horizontal">
                <TextBlock Text="Legenda:" Foreground="#6B7280" FontSize="11" VerticalAlignment="Center" Margin="0,0,12,0"/>

                <Border Width="12" Height="12" Background="#FEE2E2" BorderBrush="#F87171" BorderThickness="1" CornerRadius="2"/>
                <TextBlock Text=" Przekroczony limit" FontSize="11" VerticalAlignment="Center" Margin="4,0,16,0"/>

                <Border Width="12" Height="12" Background="#FEF9C3" BorderBrush="#FACC15" BorderThickness="1" CornerRadius="2"/>
                <TextBlock Text=" Przeterminowane" FontSize="11" VerticalAlignment="Center" Margin="4,0,16,0"/>

                <Border Width="12" Height="12" Background="#FFEDD5" BorderBrush="#FB923C" BorderThickness="1" CornerRadius="2"/>
                <TextBlock Text=" Nieaktywny 30d" FontSize="11" VerticalAlignment="Center" Margin="4,0,16,0"/>

                <Border Width="12" Height="12" Background="#DBEAFE" BorderBrush="#60A5FA" BorderThickness="1" CornerRadius="2"/>
                <TextBlock Text=" Nowy klient" FontSize="11" VerticalAlignment="Center" Margin="4,0,16,0"/>

                <!-- Licznik -->
                <TextBlock x:Name="TextBlockLicznik" Text="" FontSize="11" Foreground="#6B7280"
                           VerticalAlignment="Center" HorizontalAlignment="Right" Margin="20,0,0,0"/>
            </StackPanel>
        </Border>

        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <!-- TABELA GÅÃ“WNA -->
        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <DataGrid Grid.Row="2" x:Name="DataGridOdbiorcy"
                  Style="{StaticResource KartotekaDataGrid}"
                  ColumnHeaderStyle="{StaticResource KartotekaColumnHeader}"
                  CellStyle="{StaticResource KartotekaDataGridCell}"
                  RowStyle="{StaticResource KartotekaDataGridRow}"
                  SelectionChanged="DataGridOdbiorcy_SelectionChanged"
                  MouseDoubleClick="DataGridOdbiorcy_MouseDoubleClick"
                  Margin="0">

            <DataGrid.ContextMenu>
                <ContextMenu>
                    <MenuItem Header="ðŸ“ Edytuj dane" InputGestureText="Enter" Click="MenuEdytuj_Click"/>
                    <MenuItem Header="ðŸ“ž ZadzwoÅ„" Click="MenuZadzwon_Click"/>
                    <MenuItem Header="ðŸ“§ WyÅ›lij email" Click="MenuEmail_Click"/>
                    <Separator/>
                    <MenuItem Header="ðŸ“‹ Kopiuj dane" InputGestureText="Ctrl+C" Click="MenuKopiuj_Click"/>
                </ContextMenu>
            </DataGrid.ContextMenu>

            <DataGrid.Columns>
                <!-- Alert icon + Firma -->
                <DataGridTemplateColumn Header="Firma" Width="220" SortMemberPath="NazwaFirmy" CanUserSort="True">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="{Binding AlertType, Converter={StaticResource AlertToIconConverter}}"
                                           FontSize="12" Margin="0,0,4,0" VerticalAlignment="Center"/>
                                <TextBlock Text="{Binding NazwaFirmy}" FontWeight="SemiBold"
                                           TextTrimming="CharacterEllipsis" VerticalAlignment="Center"/>
                            </StackPanel>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>

                <DataGridTextColumn Header="Miasto" Binding="{Binding Miasto}" Width="100"/>
                <DataGridTextColumn Header="Kontakt" Binding="{Binding OsobaKontaktowa}" Width="120"/>

                <!-- Telefon - klikalny -->
                <DataGridTemplateColumn Header="Telefon" Width="110">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <TextBlock>
                                <Hyperlink Click="Hyperlink_Telefon_Click"
                                           NavigateUri="{Binding TelefonKontakt, StringFormat=tel:{0}}"
                                           Style="{StaticResource KartotekaHyperlink}">
                                    <TextBlock Text="{Binding TelefonKontakt}"/>
                                </Hyperlink>
                            </TextBlock>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>

                <!-- Email - klikalny -->
                <DataGridTemplateColumn Header="Email" Width="150">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <TextBlock TextTrimming="CharacterEllipsis">
                                <Hyperlink Click="Hyperlink_Email_Click"
                                           NavigateUri="{Binding EmailKontakt, StringFormat=mailto:{0}}"
                                           Style="{StaticResource KartotekaHyperlink}">
                                    <TextBlock Text="{Binding EmailKontakt}"/>
                                </Hyperlink>
                            </TextBlock>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>

                <DataGridTextColumn Header="Limit" Binding="{Binding LimitKupiecki, StringFormat=N0}" Width="90">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="TextAlignment" Value="Right"/>
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>

                <!-- Wykorzystano -->
                <DataGridTemplateColumn Header="Wykorzystano" Width="90">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding WykorzystanoLimit, Converter={StaticResource DecimalToFormattedConverter}}"
                                       TextAlignment="Right" HorizontalAlignment="Right">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding PrzekroczonyLimit}" Value="True">
                                                <Setter Property="Foreground" Value="#DC2626"/>
                                                <Setter Property="FontWeight" Value="Bold"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>

                <!-- % z ProgressBar -->
                <DataGridTemplateColumn Header="%" Width="80">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Grid>
                                <ProgressBar Value="{Binding ProcentWykorzystania, Mode=OneWay}"
                                             Maximum="100" Height="8" VerticalAlignment="Center"
                                             Background="#E5E7EB"
                                             Foreground="{Binding ProcentWykorzystania, Converter={StaticResource ProcentToProgressColorConverter}}"/>
                                <TextBlock Text="{Binding ProcentWykorzystania, StringFormat={}{0:F0}%}"
                                           HorizontalAlignment="Right" FontSize="10" Margin="0,0,2,0"
                                           VerticalAlignment="Center"/>
                            </Grid>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>

                <!-- Kategoria (kÃ³Å‚ko) -->
                <DataGridTemplateColumn Header="Kat." Width="50">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Border Width="28" Height="28" CornerRadius="14"
                                    Background="{Binding KategoriaHandlowca, Converter={StaticResource KategoriaToBackgroundConverter}}"
                                    HorizontalAlignment="Center">
                                <TextBlock Text="{Binding KategoriaHandlowca}" HorizontalAlignment="Center"
                                           VerticalAlignment="Center" FontWeight="Bold" FontSize="12"
                                           Foreground="{Binding KategoriaHandlowca, Converter={StaticResource KategoriaToForegroundConverter}}"/>
                            </Border>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>

                <DataGridTextColumn Header="Asortyment" Binding="{Binding AsortymentSkrocony}" Width="150"/>

                <!-- Handlowiec - tylko admin -->
                <DataGridTextColumn x:Name="ColumnHandlowiec" Header="Handlowiec" Binding="{Binding Handlowiec}" Width="90"
                                    Visibility="Collapsed"/>
            </DataGrid.Columns>
        </DataGrid>

        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <!-- SPLITTER -->
        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <GridSplitter Grid.Row="3" Height="4" HorizontalAlignment="Stretch"
                      Background="#BBF7D0" ResizeDirection="Rows"/>

        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <!-- PANEL SZCZEGÃ“ÅÃ“W -->
        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <Border Grid.Row="4" Background="#F0FDF4">
            <TabControl x:Name="TabControlSzczegoly" Background="Transparent"
                        BorderBrush="#BBF7D0" BorderThickness="0,1,0,0"
                        SelectionChanged="TabControlSzczegoly_SelectionChanged">

                <!-- ===== KONTAKTY ===== -->
                <TabItem Header="ðŸ“ž Kontakty" Style="{StaticResource KartotekaTabItem}">
                    <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Auto" Padding="12">
                        <WrapPanel x:Name="WrapPanelKontakty" Margin="8"/>
                    </ScrollViewer>
                </TabItem>

                <!-- ===== FINANSE ===== -->
                <TabItem Header="ðŸ’° Finanse" Style="{StaticResource KartotekaTabItem}">
                    <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="12">
                        <Grid Margin="8">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>

                            <!-- Karty statystyk -->
                            <WrapPanel Grid.Row="0" Margin="0,0,0,12">
                                <!-- Limit -->
                                <Border Style="{StaticResource StatCard}" Width="200">
                                    <StackPanel>
                                        <TextBlock Text="ðŸ’° Limit kupiecki" Foreground="#6B7280" FontSize="11"/>
                                        <TextBlock x:Name="TextFinanseLimitKwota" Text="-" FontSize="22" FontWeight="Bold" Foreground="#166534" Margin="0,4,0,0"/>
                                        <Grid Margin="0,8,0,0">
                                            <ProgressBar x:Name="ProgressFinanseLimit" Maximum="100" Value="0" Height="8" Background="#E5E7EB" Foreground="#22C55E"/>
                                        </Grid>
                                        <TextBlock x:Name="TextFinanseWolne" Text="" FontSize="11" Foreground="#6B7280" Margin="0,4,0,0"/>
                                    </StackPanel>
                                </Border>

                                <!-- PÅ‚atnoÅ›ci -->
                                <Border Style="{StaticResource StatCard}" Width="200">
                                    <StackPanel>
                                        <TextBlock Text="ðŸ“„ PÅ‚atnoÅ›ci" Foreground="#6B7280" FontSize="11"/>
                                        <TextBlock x:Name="TextFinansePlatnosc" Text="-" FontSize="14" FontWeight="SemiBold" Margin="0,4,0,0"/>
                                        <TextBlock x:Name="TextFinanseDoZaplaty" Text="" FontSize="11" Margin="0,4,0,0"/>
                                        <TextBlock x:Name="TextFinansePrzeteminowane" Text="" FontSize="11" Margin="0,2,0,0"/>
                                    </StackPanel>
                                </Border>

                                <!-- ObrÃ³t 12m -->
                                <Border Style="{StaticResource StatCard}" Width="200">
                                    <StackPanel>
                                        <TextBlock Text="ðŸ“ˆ ObrÃ³t 12m" Foreground="#6B7280" FontSize="11"/>
                                        <TextBlock x:Name="TextFinanseObrot" Text="-" FontSize="22" FontWeight="Bold" Foreground="#166534" Margin="0,4,0,0"/>
                                        <TextBlock x:Name="TextFinanseFakturCount" Text="" FontSize="11" Foreground="#6B7280" Margin="0,4,0,0"/>
                                    </StackPanel>
                                </Border>
                            </WrapPanel>

                            <!-- Tabela faktur -->
                            <DataGrid Grid.Row="1" x:Name="DataGridFaktury"
                                      Style="{StaticResource KartotekaDataGrid}"
                                      ColumnHeaderStyle="{StaticResource KartotekaColumnHeader}"
                                      CellStyle="{StaticResource KartotekaDataGridCell}"
                                      MaxHeight="300">
                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="Data" Binding="{Binding DataFaktury, StringFormat=dd.MM.yyyy}" Width="90"/>
                                    <DataGridTextColumn Header="WartoÅ›Ä‡ brutto" Binding="{Binding Brutto, StringFormat=N2}" Width="110"/>
                                    <DataGridTextColumn Header="Rozliczono" Binding="{Binding Rozliczono, StringFormat=N2}" Width="110"/>
                                    <DataGridTextColumn Header="Do zapÅ‚aty" Binding="{Binding DoZaplaty, StringFormat=N2}" Width="110"/>
                                    <DataGridTextColumn Header="Termin" Binding="{Binding TerminPlatnosci, StringFormat=dd.MM.yyyy}" Width="90"/>
                                    <DataGridTemplateColumn Header="Status" Width="110">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding Status}" FontWeight="SemiBold"
                                                           Foreground="{Binding Status, Converter={StaticResource FakturaStatusToColorConverter}}"/>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>
                                    <DataGridTextColumn Header="Dni po term." Binding="{Binding DniPoTerminie}" Width="80"/>
                                </DataGrid.Columns>
                            </DataGrid>
                        </Grid>
                    </ScrollViewer>
                </TabItem>

                <!-- ===== ASORTYMENT ===== -->
                <TabItem Header="ðŸ— Asortyment" Style="{StaticResource KartotekaTabItem}">
                    <ScrollViewer Padding="12">
                        <StackPanel Margin="8">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <!-- Preferencje -->
                                <Border Grid.Column="0" Style="{StaticResource StatCard}">
                                    <StackPanel>
                                        <TextBlock Text="âš™ï¸ Preferencje klienta" FontWeight="Bold" FontSize="14" Margin="0,0,0,12"/>
                                        <StackPanel Margin="0,0,0,8">
                                            <TextBlock Text="ðŸ“¦ Pakowanie:" Foreground="#6B7280" FontSize="11"/>
                                            <TextBlock x:Name="TextAsortymentPakowanie" Text="-" FontWeight="SemiBold" Margin="0,2,0,0"/>
                                        </StackPanel>
                                        <StackPanel Margin="0,0,0,8">
                                            <TextBlock Text="â­ JakoÅ›Ä‡:" Foreground="#6B7280" FontSize="11"/>
                                            <TextBlock x:Name="TextAsortymentJakosc" Text="-" FontWeight="SemiBold" Margin="0,2,0,0"/>
                                        </StackPanel>
                                        <StackPanel Margin="0,0,0,8">
                                            <TextBlock Text="ðŸ— Asortyment:" Foreground="#6B7280" FontSize="11"/>
                                            <TextBlock x:Name="TextAsortymentLista" Text="-" FontWeight="SemiBold" TextWrapping="Wrap" Margin="0,2,0,0"/>
                                        </StackPanel>
                                    </StackPanel>
                                </Border>

                                <!-- Dostawy -->
                                <Border Grid.Column="1" Style="{StaticResource StatCard}">
                                    <StackPanel>
                                        <TextBlock Text="ðŸšš Preferencje dostawy" FontWeight="Bold" FontSize="14" Margin="0,0,0,12"/>
                                        <StackPanel Margin="0,0,0,8">
                                            <TextBlock Text="ðŸ“… Preferowane dni:" Foreground="#6B7280" FontSize="11"/>
                                            <TextBlock x:Name="TextAsortymentDni" Text="-" FontWeight="SemiBold" Margin="0,2,0,0"/>
                                        </StackPanel>
                                        <StackPanel Margin="0,0,0,8">
                                            <TextBlock Text="ðŸ• Godzina:" Foreground="#6B7280" FontSize="11"/>
                                            <TextBlock x:Name="TextAsortymentGodzina" Text="-" FontWeight="SemiBold" Margin="0,2,0,0"/>
                                        </StackPanel>
                                        <StackPanel Margin="0,0,0,8">
                                            <TextBlock Text="ðŸ“ Adres dostawy (inny):" Foreground="#6B7280" FontSize="11"/>
                                            <TextBlock x:Name="TextAsortymentAdres" Text="= adres gÅ‚Ã³wny" FontWeight="SemiBold" TextWrapping="Wrap" Margin="0,2,0,0"/>
                                        </StackPanel>
                                        <StackPanel Margin="0,0,0,8">
                                            <TextBlock Text="ðŸ›£ï¸ Trasa:" Foreground="#6B7280" FontSize="11"/>
                                            <TextBlock x:Name="TextAsortymentTrasa" Text="-" FontWeight="SemiBold" Margin="0,2,0,0"/>
                                        </StackPanel>
                                    </StackPanel>
                                </Border>
                            </Grid>

                            <!-- Podsumowanie asortymentu -->
                            <TextBlock Text="ðŸ“Š Historia kupowanych produktÃ³w (ostatnie 12 mies.)" FontWeight="Bold" FontSize="14" Margin="0,16,0,8"/>

                            <Border Background="#F0FDF4" CornerRadius="8" Padding="12" Margin="0,0,0,8" BorderBrush="#BBF7D0" BorderThickness="1">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <StackPanel Grid.Column="0" HorizontalAlignment="Center">
                                        <TextBlock Text="ProduktÃ³w" Foreground="#6B7280" FontSize="11" HorizontalAlignment="Center"/>
                                        <TextBlock x:Name="TextAsortymentIloscProduktow" Text="0" FontWeight="Bold" FontSize="18" Foreground="#059669" HorizontalAlignment="Center"/>
                                    </StackPanel>
                                    <StackPanel Grid.Column="1" HorizontalAlignment="Center">
                                        <TextBlock Text="ÅÄ…cznie kg" Foreground="#6B7280" FontSize="11" HorizontalAlignment="Center"/>
                                        <TextBlock x:Name="TextAsortymentSumaKg" Text="0" FontWeight="Bold" FontSize="18" Foreground="#059669" HorizontalAlignment="Center"/>
                                    </StackPanel>
                                    <StackPanel Grid.Column="2" HorizontalAlignment="Center">
                                        <TextBlock Text="WartoÅ›Ä‡ netto" Foreground="#6B7280" FontSize="11" HorizontalAlignment="Center"/>
                                        <TextBlock x:Name="TextAsortymentSumaWartosc" Text="0 zÅ‚" FontWeight="Bold" FontSize="18" Foreground="#059669" HorizontalAlignment="Center"/>
                                    </StackPanel>
                                    <StackPanel Grid.Column="3" HorizontalAlignment="Center">
                                        <TextBlock Text="Åšr. cena/kg" Foreground="#6B7280" FontSize="11" HorizontalAlignment="Center"/>
                                        <TextBlock x:Name="TextAsortymentSredniaCena" Text="0 zÅ‚" FontWeight="Bold" FontSize="18" Foreground="#059669" HorizontalAlignment="Center"/>
                                    </StackPanel>
                                </Grid>
                            </Border>

                            <!-- Tabela produktÃ³w -->
                            <DataGrid x:Name="DataGridAsortyment"
                                      Style="{StaticResource KartotekaDataGrid}"
                                      ColumnHeaderStyle="{StaticResource KartotekaColumnHeader}"
                                      CellStyle="{StaticResource KartotekaDataGridCell}"
                                      MaxHeight="300">
                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="Produkt" Binding="{Binding ProduktKod}" Width="130"/>
                                    <DataGridTextColumn Header="Nazwa" Binding="{Binding ProduktNazwa}" Width="*"/>
                                    <DataGridTextColumn Header="IloÅ›Ä‡ (kg)" Binding="{Binding SumaKg, StringFormat=N0}" Width="90">
                                        <DataGridTextColumn.ElementStyle>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="HorizontalAlignment" Value="Right"/>
                                                <Setter Property="Padding" Value="0,0,8,0"/>
                                            </Style>
                                        </DataGridTextColumn.ElementStyle>
                                    </DataGridTextColumn>
                                    <DataGridTextColumn Header="WartoÅ›Ä‡ netto" Binding="{Binding SumaWartosc, StringFormat=N0}" Width="110">
                                        <DataGridTextColumn.ElementStyle>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="HorizontalAlignment" Value="Right"/>
                                                <Setter Property="Padding" Value="0,0,8,0"/>
                                                <Setter Property="FontWeight" Value="SemiBold"/>
                                            </Style>
                                        </DataGridTextColumn.ElementStyle>
                                    </DataGridTextColumn>
                                    <DataGridTextColumn Header="Åšr. cena/kg" Binding="{Binding SredniaCena, StringFormat=N2}" Width="90">
                                        <DataGridTextColumn.ElementStyle>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="HorizontalAlignment" Value="Right"/>
                                                <Setter Property="Padding" Value="0,0,8,0"/>
                                            </Style>
                                        </DataGridTextColumn.ElementStyle>
                                    </DataGridTextColumn>
                                    <DataGridTextColumn Header="Faktur" Binding="{Binding LiczbaFaktur}" Width="60">
                                        <DataGridTextColumn.ElementStyle>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="HorizontalAlignment" Value="Center"/>
                                            </Style>
                                        </DataGridTextColumn.ElementStyle>
                                    </DataGridTextColumn>
                                    <DataGridTextColumn Header="Ostatnia sprzedaÅ¼" Binding="{Binding OstatniaSprzedaz, StringFormat=dd.MM.yyyy}" Width="120"/>
                                </DataGrid.Columns>
                            </DataGrid>
                        </StackPanel>
                    </ScrollViewer>
                </TabItem>

                <!-- ===== HISTORIA ===== -->
                <TabItem Header="ðŸ“Š Historia" Style="{StaticResource KartotekaTabItem}">
                    <Grid Margin="12">
                        <DataGrid x:Name="DataGridHistoria"
                                  Style="{StaticResource KartotekaDataGrid}"
                                  ColumnHeaderStyle="{StaticResource KartotekaColumnHeader}"
                                  CellStyle="{StaticResource KartotekaDataGridCell}">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Data" Binding="{Binding DataFaktury, StringFormat=dd.MM.yyyy}" Width="90"/>
                                <DataGridTextColumn Header="WartoÅ›Ä‡" Binding="{Binding Brutto, StringFormat=N2}" Width="110"/>
                                <DataGridTextColumn Header="Typ" Binding="{Binding Typ}" Width="60"/>
                                <DataGridTemplateColumn Header="Status" Width="110">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding Status}" FontWeight="SemiBold"
                                                       Foreground="{Binding Status, Converter={StaticResource FakturaStatusToColorConverter}}"/>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                            </DataGrid.Columns>
                        </DataGrid>
                    </Grid>
                </TabItem>

                <!-- ===== NOTATKI ===== -->
                <TabItem Header="ðŸ“ Notatki" Style="{StaticResource KartotekaTabItem}">
                    <Grid Margin="12">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Border Style="{StaticResource StatCard}">
                            <StackPanel>
                                <TextBlock Text="ðŸ“ Notatki handlowca" FontWeight="Bold" FontSize="14" Margin="0,0,0,8"/>
                                <TextBox x:Name="TextBoxNotatki" TextWrapping="Wrap" AcceptsReturn="True"
                                         MinHeight="120" MaxHeight="300" VerticalScrollBarVisibility="Auto"
                                         BorderBrush="#BBF7D0" BorderThickness="1" Padding="8"
                                         FontSize="13"/>
                                <Button Content="ðŸ’¾ Zapisz notatki" Style="{StaticResource KartotekaPrimaryButton}"
                                        HorizontalAlignment="Left" Margin="0,8,0,0"
                                        Click="ButtonZapiszNotatki_Click"/>
                            </StackPanel>
                        </Border>
                    </Grid>
                </TabItem>

                <!-- ===== POJEMNIKI ===== -->
                <TabItem Header="ðŸ“¦ Pojemniki" Style="{StaticResource KartotekaTabItem}">
                    <Grid Margin="12">
                        <Border Style="{StaticResource StatCard}">
                            <StackPanel>
                                <TextBlock Text="ðŸ“¦ Saldo pojemnikÃ³w" FontWeight="Bold" FontSize="14" Margin="0,0,0,8"/>
                                <TextBlock Text="Dane pojemnikÃ³w dostÄ™pne w module Opakowania" Foreground="#6B7280" FontSize="12"/>
                            </StackPanel>
                        </Border>
                    </Grid>
                </TabItem>

                <!-- ===== DOSTAWY ===== -->
                <TabItem Header="ðŸšš Dostawy" Style="{StaticResource KartotekaTabItem}">
                    <ScrollViewer Padding="12">
                        <Grid Margin="8">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <Border Grid.Column="0" Style="{StaticResource StatCard}">
                                <StackPanel>
                                    <TextBlock Text="ðŸšš Preferencje dostawy" FontWeight="Bold" FontSize="14" Margin="0,0,0,12"/>
                                    <TextBlock x:Name="TextDostawyDni" Text="Preferowane dni: -" Margin="0,0,0,4"/>
                                    <TextBlock x:Name="TextDostawyGodzina" Text="Godzina: -" Margin="0,0,0,4"/>
                                    <TextBlock x:Name="TextDostawyAdres" Text="Adres: = adres gÅ‚Ã³wny" TextWrapping="Wrap" Margin="0,0,0,4"/>
                                    <TextBlock x:Name="TextDostawyTrasa" Text="Trasa: -" Margin="0,0,0,4"/>
                                </StackPanel>
                            </Border>

                            <Border Grid.Column="1" Style="{StaticResource StatCard}">
                                <StackPanel>
                                    <TextBlock Text="ðŸ“‹ Dane adresowe (Symfonia)" FontWeight="Bold" FontSize="14" Margin="0,0,0,12"/>
                                    <TextBlock x:Name="TextDostawyFirma" Text="-" FontWeight="SemiBold" Margin="0,0,0,4"/>
                                    <TextBlock x:Name="TextDostawyUlica" Text="-" Margin="0,0,0,4"/>
                                    <TextBlock x:Name="TextDostawyMiasto" Text="-" Margin="0,0,0,4"/>
                                    <TextBlock x:Name="TextDostawyNIP" Text="-" Foreground="#6B7280" Margin="0,0,0,4"/>
                                </StackPanel>
                            </Border>
                        </Grid>
                    </ScrollViewer>
                </TabItem>

                <!-- ===== REKLAMACJE ===== -->
                <TabItem Header="âš ï¸ Reklamacje" Style="{StaticResource KartotekaTabItem}">
                    <Grid Margin="12">
                        <Border Style="{StaticResource StatCard}">
                            <StackPanel>
                                <TextBlock Text="âš ï¸ Reklamacje" FontWeight="Bold" FontSize="14" Margin="0,0,0,8"/>
                                <TextBlock Text="ModuÅ‚ reklamacji w przygotowaniu" Foreground="#6B7280" FontSize="12"/>
                            </StackPanel>
                        </Border>
                    </Grid>
                </TabItem>
            </TabControl>
        </Border>

        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <!-- STOPKA -->
        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <Border Grid.Row="5" Background="#14532D" Padding="16,6">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Podpowiedzi -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBlock Text="ðŸ’¡ Dwuklik = edycja" Foreground="#BBF7D0" FontSize="11"/>
                    <TextBlock Text=" â€¢ " Foreground="#4B5563" FontSize="11"/>
                    <TextBlock Text="PPM = menu" Foreground="#BBF7D0" FontSize="11"/>
                    <TextBlock Text=" â€¢ " Foreground="#4B5563" FontSize="11"/>
                    <TextBlock Text="F5 = odÅ›wieÅ¼ | Ctrl+F = szukaj" Foreground="#4ADE80" FontSize="11"/>
                </StackPanel>

                <!-- Statystyki -->
                <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBlock Text="Suma limitÃ³w: " Foreground="#BBF7D0" FontSize="11"/>
                    <TextBlock x:Name="TextStopkaSumaLimitow" Text="0" Foreground="White" FontWeight="Bold" FontSize="11"/>
                    <TextBlock Text=" zÅ‚" Foreground="#BBF7D0" FontSize="11" Margin="0,0,16,0"/>

                    <TextBlock Text="Wykorzystano: " Foreground="#BBF7D0" FontSize="11"/>
                    <TextBlock x:Name="TextStopkaWykorzystano" Text="0" Foreground="#FDE047" FontWeight="Bold" FontSize="11"/>
                    <TextBlock Text=" zÅ‚" Foreground="#BBF7D0" FontSize="11" Margin="0,0,16,0"/>

                    <TextBlock Text="Wolne: " Foreground="#BBF7D0" FontSize="11"/>
                    <TextBlock x:Name="TextStopkaWolne" Text="0" Foreground="#4ADE80" FontWeight="Bold" FontSize="11"/>
                    <TextBlock Text=" zÅ‚" Foreground="#BBF7D0" FontSize="11" Margin="0,0,16,0"/>

                    <TextBlock Text="Przeterminowane: " Foreground="#BBF7D0" FontSize="11"/>
                    <TextBlock x:Name="TextStopkaPrzeterminowane" Text="0" Foreground="#F87171" FontWeight="Bold" FontSize="11"/>
                    <TextBlock Text=" zÅ‚" Foreground="#BBF7D0" FontSize="11"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Loading overlay -->
        <Border x:Name="LoadingOverlay" Grid.RowSpan="6" Background="#80000000" Visibility="Collapsed">
            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                <TextBlock Text="â³ Åadowanie danych..." Foreground="White" FontSize="18" FontWeight="Bold"
                           HorizontalAlignment="Center"/>
                <ProgressBar IsIndeterminate="True" Width="200" Height="4" Margin="0,12,0,0"
                             Foreground="#059669"/>
            </StackPanel>
        </Border>
    </Grid>
</Window>
