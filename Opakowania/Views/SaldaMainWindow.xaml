<Window x:Class="Kalendarz1.Opakowania.Views.SaldaMainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Salda Opakowań"
        WindowState="Maximized"
        WindowStartupLocation="CenterScreen"
        Background="#F8FFF8">

    <Window.Resources>
        <!-- Style zakładek - biało-zielone -->
        <Style x:Key="TabStyle" TargetType="TabItem">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TabItem">
                        <Border x:Name="Border" Padding="16,10" Margin="2,0" CornerRadius="8,8,0,0"
                                Background="#E8F5E9" Cursor="Hand">
                            <ContentPresenter ContentSource="Header" HorizontalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="#2E7D32"/>
                                <Setter Property="Foreground" Value="White"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="#81C784"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="FontSize" Value="14"/>
        </Style>

        <!-- Style przycisków - zielone -->
        <Style x:Key="BtnStyle" TargetType="Button">
            <Setter Property="Padding" Value="16,8"/>
            <Setter Property="Background" Value="#2E7D32"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" CornerRadius="6" Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#1B5E20"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Style DataGrid -->
        <Style TargetType="DataGrid">
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="RowHeaderWidth" Value="0"/>
            <Setter Property="GridLinesVisibility" Value="Horizontal"/>
            <Setter Property="HorizontalGridLinesBrush" Value="#C8E6C9"/>
            <Setter Property="CanUserAddRows" Value="False"/>
            <Setter Property="CanUserDeleteRows" Value="False"/>
            <Setter Property="AutoGenerateColumns" Value="False"/>
            <Setter Property="SelectionMode" Value="Single"/>
            <Setter Property="IsReadOnly" Value="True"/>
        </Style>

        <Style TargetType="DataGridRow">
            <Setter Property="Background" Value="White"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#E8F5E9"/>
                </Trigger>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="#C8E6C9"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style TargetType="DataGridCell">
            <Setter Property="Padding" Value="8,6"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="DataGridCell">
                        <Border Padding="{TemplateBinding Padding}" Background="{TemplateBinding Background}">
                            <ContentPresenter VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="Transparent"/>
                    <Setter Property="Foreground" Value="Black"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style TargetType="DataGridColumnHeader">
            <Setter Property="Background" Value="#E8F5E9"/>
            <Setter Property="Padding" Value="8,10"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Foreground" Value="#1B5E20"/>
            <Setter Property="BorderBrush" Value="#C8E6C9"/>
            <Setter Property="BorderThickness" Value="0,0,0,1"/>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="Auto"/>
        </Grid.ColumnDefinitions>

        <!-- LEWA STRONA - główna zawartość -->
        <Grid Grid.Column="0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

        <!-- Nagłówek - biało-zielony -->
        <Border Grid.Row="0" Background="White" Padding="20,16" BorderBrush="#C8E6C9" BorderThickness="0,0,0,1">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBlock Text="Salda Opakowań" FontSize="24" FontWeight="Bold" Foreground="#1B5E20"/>
                    <TextBlock Text="{Binding NazwaHandlowca, StringFormat=' - {0}'}" FontSize="16"
                               Foreground="#4CAF50" VerticalAlignment="Bottom" Margin="8,0,0,2"/>
                </StackPanel>

                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <Button x:Name="btnDashboard" Content="&#xE9D5; Dashboard potwierdzeń" Style="{StaticResource BtnStyle}"
                            Click="BtnDashboard_Click" Margin="0,0,8,0" FontFamily="Segoe MDL2 Assets, Segoe UI"/>
                    <Button Content="Odśwież" Command="{Binding OdswiezCommand}" Style="{StaticResource BtnStyle}" Margin="0,0,8,0"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Toolbar: szukaj + data -->
        <Border Grid.Row="1" Background="White" Padding="20,12" BorderBrush="#C8E6C9" BorderThickness="0,0,0,1">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="300"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Szukaj -->
                <Border Background="#E8F5E9" CornerRadius="6" Padding="12,8">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Text="&#xE721;" FontFamily="Segoe MDL2 Assets" Foreground="#4CAF50"
                                   VerticalAlignment="Center" Margin="0,0,8,0"/>
                        <TextBox Grid.Column="1" Text="{Binding FiltrTekst, UpdateSourceTrigger=PropertyChanged}"
                                 Background="Transparent" BorderThickness="0" VerticalAlignment="Center"
                                 FontSize="14">
                            <TextBox.Style>
                                <Style TargetType="TextBox">
                                    <Style.Triggers>
                                        <Trigger Property="Text" Value="">
                                            <Setter Property="Background">
                                                <Setter.Value>
                                                    <VisualBrush Stretch="None" AlignmentX="Left">
                                                        <VisualBrush.Visual>
                                                            <TextBlock Text="Szukaj kontrahenta..." Foreground="#81C784"/>
                                                        </VisualBrush.Visual>
                                                    </VisualBrush>
                                                </Setter.Value>
                                            </Setter>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBox.Style>
                        </TextBox>
                    </Grid>
                </Border>

                <!-- Data DO -->
                <StackPanel Grid.Column="2" Orientation="Horizontal">
                    <TextBlock Text="Stan na dzień:" VerticalAlignment="Center" Margin="0,0,8,0" Foreground="#4CAF50"/>
                    <DatePicker SelectedDate="{Binding DataDo}" Width="130" VerticalAlignment="Center"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Zakładki + DataGrid - tylko E2 i H1 -->
        <TabControl Grid.Row="2" Margin="20" SelectedIndex="{Binding WybranaZakladka}">

            <!-- E2 -->
            <TabItem Header="  E2  " Style="{StaticResource TabStyle}">
                <DataGrid ItemsSource="{Binding ListaE2}" SelectedItem="{Binding WybranyKontrahent}"
                          MouseDoubleClick="DataGrid_MouseDoubleClick">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Kontrahent" Binding="{Binding Kontrahent}" Width="150"/>
                        <DataGridTextColumn Header="Nazwa" Binding="{Binding Nazwa}" Width="*"/>
                        <DataGridTemplateColumn Header="E2" Width="100">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding E2Tekst}" Foreground="{Binding E2Kolor}"
                                               FontWeight="Bold" HorizontalAlignment="Right"/>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                        <DataGridTextColumn Header="Handlowiec" Binding="{Binding Handlowiec}" Width="120"/>
                        <DataGridTextColumn Header="Ostatni dok." Binding="{Binding OstatniDokumentTekst}" Width="90"/>
                        <DataGridTemplateColumn Header="Status potw." Width="100">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal" ToolTip="{Binding E2StatusTooltip}">
                                        <TextBlock Text="{Binding E2StatusIkona}" FontFamily="Segoe MDL2 Assets"
                                                   Foreground="{Binding E2StatusKolor}" FontSize="14"
                                                   VerticalAlignment="Center" Margin="0,0,4,0"/>
                                        <TextBlock Text="{Binding E2StatusTekst}" Foreground="{Binding E2StatusKolor}"
                                                   FontSize="11" VerticalAlignment="Center"/>
                                    </StackPanel>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                    </DataGrid.Columns>
                </DataGrid>
            </TabItem>

            <!-- H1 -->
            <TabItem Header="  H1  " Style="{StaticResource TabStyle}">
                <DataGrid ItemsSource="{Binding ListaH1}" SelectedItem="{Binding WybranyKontrahent}"
                          MouseDoubleClick="DataGrid_MouseDoubleClick">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Kontrahent" Binding="{Binding Kontrahent}" Width="150"/>
                        <DataGridTextColumn Header="Nazwa" Binding="{Binding Nazwa}" Width="*"/>
                        <DataGridTemplateColumn Header="H1" Width="100">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding H1Tekst}" Foreground="{Binding H1Kolor}"
                                               FontWeight="Bold" HorizontalAlignment="Right"/>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                        <DataGridTextColumn Header="Handlowiec" Binding="{Binding Handlowiec}" Width="120"/>
                        <DataGridTextColumn Header="Ostatni dok." Binding="{Binding OstatniDokumentTekst}" Width="90"/>
                        <DataGridTemplateColumn Header="Status potw." Width="100">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal" ToolTip="{Binding H1StatusTooltip}">
                                        <TextBlock Text="{Binding H1StatusIkona}" FontFamily="Segoe MDL2 Assets"
                                                   Foreground="{Binding H1StatusKolor}" FontSize="14"
                                                   VerticalAlignment="Center" Margin="0,0,4,0"/>
                                        <TextBlock Text="{Binding H1StatusTekst}" Foreground="{Binding H1StatusKolor}"
                                                   FontSize="11" VerticalAlignment="Center"/>
                                    </StackPanel>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                    </DataGrid.Columns>
                </DataGrid>
            </TabItem>

            <!-- EURO - UKRYTE -->
            <!-- PCV - UKRYTE -->
            <!-- DREW - UKRYTE -->

        </TabControl>

        <!-- Stopka - statystyki -->
        <Border Grid.Row="3" Background="White" Padding="20,12" BorderBrush="#C8E6C9" BorderThickness="0,1,0,0">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="Kontrahentów: " Foreground="#4CAF50"/>
                    <TextBlock Text="{Binding LiczbaKontrahentow}" FontWeight="Bold" Foreground="#1B5E20" Margin="0,0,20,0"/>

                    <TextBlock Text="Wydane: " Foreground="#4CAF50"/>
                    <TextBlock Text="{Binding SumaWydane}" FontWeight="Bold" Foreground="#C62828" Margin="0,0,20,0"/>

                    <TextBlock Text="Zwroty: " Foreground="#4CAF50"/>
                    <TextBlock Text="{Binding SumaZwroty}" FontWeight="Bold" Foreground="#2E7D32"/>
                </StackPanel>

                <TextBlock Grid.Column="1" Text="{Binding StatusLadowania}" Foreground="#4CAF50"/>
            </Grid>
        </Border>

        <!-- Loading overlay -->
        <Border Grid.RowSpan="4" Background="#80FFFFFF" Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibility}}">
            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                <ProgressBar IsIndeterminate="True" Width="200" Height="4" Foreground="#2E7D32"/>
                <TextBlock Text="{Binding StatusLadowania}" Margin="0,8,0,0" HorizontalAlignment="Center" Foreground="#1B5E20"/>
            </StackPanel>
        </Border>
        </Grid>

        <!-- PRAWA STRONA - panel diagnostyki (UKRYTY) -->
        <Border Grid.Column="1" Background="#1E1E1E" BorderBrush="#2E7D32" BorderThickness="2,0,0,0"
                Visibility="Collapsed">
            <Grid Margin="15">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Nagłówek diagnostyki -->
                <StackPanel Grid.Row="0" Margin="0,0,0,15">
                    <TextBlock Text="DIAGNOSTYKA WYDAJNOŚCI" FontSize="14" FontWeight="Bold" Foreground="#4CAF50"/>
                    <TextBlock Text="Pomiar czasów i cache" FontSize="11" Foreground="#888" Margin="0,2,0,0"/>
                </StackPanel>

                <!-- Metryki szybkie -->
                <Border Grid.Row="1" Background="#252526" CornerRadius="6" Padding="12" Margin="0,0,0,10">
                    <StackPanel>
                        <TextBlock Text="METRYKI" FontSize="10" Foreground="#888" FontWeight="Bold" Margin="0,0,0,8"/>

                        <Grid Margin="0,2">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="Ostatnie ładowanie:" Foreground="#AAA" FontSize="11"/>
                            <TextBlock x:Name="txtLastLoadTime" Grid.Column="1" Text="-- ms" Foreground="#4CAF50" FontWeight="Bold" FontSize="11"/>
                        </Grid>

                        <Grid Margin="0,2">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="Cache hit rate:" Foreground="#AAA" FontSize="11"/>
                            <TextBlock x:Name="txtCacheHitRate" Grid.Column="1" Text="-- %" Foreground="#81C784" FontWeight="Bold" FontSize="11"/>
                        </Grid>

                        <Grid Margin="0,2">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="Operacji łącznie:" Foreground="#AAA" FontSize="11"/>
                            <TextBlock x:Name="txtTotalOperations" Grid.Column="1" Text="0" Foreground="#FFF" FontWeight="Bold" FontSize="11"/>
                        </Grid>

                        <Grid Margin="0,2">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="Status cache:" Foreground="#AAA" FontSize="11"/>
                            <TextBlock x:Name="txtCacheStatus" Grid.Column="1" Text="--" Foreground="#A5D6A7" FontWeight="Bold" FontSize="11"/>
                        </Grid>
                    </StackPanel>
                </Border>

                <!-- Log operacji -->
                <Border Grid.Row="2" Background="#252526" CornerRadius="6" Padding="10">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <TextBlock Text="LOG OPERACJI" FontSize="10" Foreground="#888" FontWeight="Bold" Margin="0,0,0,8"/>

                        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                            <TextBox x:Name="txtDiagLog"
                                     FontFamily="Consolas"
                                     FontSize="10"
                                     Foreground="#DCDCDC"
                                     Background="Transparent"
                                     BorderThickness="0"
                                     IsReadOnly="True"
                                     TextWrapping="Wrap"
                                     AcceptsReturn="True"
                                     Text="Oczekiwanie na dane..."/>
                        </ScrollViewer>
                    </Grid>
                </Border>

                <!-- Przyciski diagnostyki - zielone -->
                <StackPanel Grid.Row="3" Margin="0,10,0,0">
                    <Button x:Name="btnRunTest" Content="TEST WYDAJNOŚCI" Click="BtnRunTest_Click"
                            Background="#2E7D32" Foreground="White" FontWeight="Bold" FontSize="11"
                            Padding="10,8" Cursor="Hand" BorderThickness="0" Margin="0,0,0,6"/>

                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <Button x:Name="btnCopyDiag" Content="Kopiuj" Click="BtnCopyDiag_Click"
                                Background="#388E3C" Foreground="White" FontWeight="Bold" FontSize="10"
                                Padding="8,6" Cursor="Hand" BorderThickness="0" Margin="0,0,3,0"/>

                        <Button x:Name="btnResetDiag" Grid.Column="1" Content="Resetuj" Click="BtnResetDiag_Click"
                                Background="#C62828" Foreground="White" FontWeight="Bold" FontSize="10"
                                Padding="8,6" Cursor="Hand" BorderThickness="0" Margin="3,0,0,0"/>
                    </Grid>

                    <TextBlock x:Name="txtLastUpdate" Text="Aktualizacja: --"
                               Foreground="#666" FontSize="9" Margin="0,8,0,0" HorizontalAlignment="Center"/>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</Window>
