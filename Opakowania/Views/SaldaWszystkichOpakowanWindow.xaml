<Window x:Class="Kalendarz1.Opakowania.Views.SaldaWszystkichOpakowanWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="ðŸ“¦ Salda Wszystkich OpakowaÅ„"
        Width="1400" Height="900"
        MinWidth="1100" MinHeight="700"
        WindowStartupLocation="CenterScreen"
        Background="#F8FFF8"
        FontFamily="Segoe UI"
        WindowStyle="None">

    <Window.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="../Resources/OpakowaniaStyles.xaml"/>
            </ResourceDictionary.MergedDictionaries>
        </ResourceDictionary>
    </Window.Resources>

    <Window.InputBindings>
        <KeyBinding Key="F5" Command="{Binding OdswiezCommand}"/>
        <KeyBinding Key="G" Modifiers="Ctrl" Command="{Binding ToggleGrupowanieCommand}"/>
        <KeyBinding Key="E" Modifiers="Ctrl" Command="{Binding EksportExcelCommand}"/>
        <KeyBinding Key="P" Modifiers="Ctrl" Command="{Binding DrukujCommand}"/>
        <KeyBinding Key="F" Modifiers="Ctrl" x:Name="FocusSzukaj"/>
        <KeyBinding Key="Escape" Command="{Binding ZamknijCommand}"/>
    </Window.InputBindings>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- ============================================== -->
        <!-- PASEK TYTUÅU - BIAÅO-ZIELONY -->
        <!-- ============================================== -->
        <Border Grid.Row="0" MouseLeftButtonDown="TitleBar_MouseLeftButtonDown">
            <Border.Background>
                <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                    <GradientStop Color="#1B5E20" Offset="0"/>
                    <GradientStop Color="#2E7D32" Offset="0.5"/>
                    <GradientStop Color="#43A047" Offset="1"/>
                </LinearGradientBrush>
            </Border.Background>
            <Grid Height="50">
                <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="15,0">
                    <TextBlock Text="ðŸ“¦" FontSize="24" VerticalAlignment="Center" Margin="0,0,12,0"/>
                    <StackPanel VerticalAlignment="Center">
                        <TextBlock Text="SALDA WSZYSTKICH OPAKOWAÅƒ" FontSize="16" FontWeight="Bold"
                                   Foreground="White"/>
                        <TextBlock Text="{Binding NazwaHandlowca}" FontSize="11" Foreground="#CCFFFFFF"/>
                    </StackPanel>
                </StackPanel>

                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                    <Button Content="ðŸ—•" Style="{StaticResource WindowButtonStyle}" Click="MinimizeButton_Click" FontSize="14"/>
                    <Button Content="ðŸ—–" Style="{StaticResource WindowButtonStyle}" Click="MaximizeButton_Click" FontSize="14"/>
                    <Button Content="âœ•" Style="{StaticResource CloseButtonStyle}" Click="CloseButton_Click" FontSize="14"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- ============================================== -->
        <!-- PASEK NARZÄ˜DZI Z PODSUMOWANIEM -->
        <!-- ============================================== -->
        <Border Grid.Row="1" Style="{StaticResource CardPanel}" Margin="12,12,12,6">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- GÃ³rny rzÄ…d: Filtry i przyciski -->
                <Grid Grid.Row="0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel Grid.Column="0" Orientation="Horizontal">
                        <StackPanel Margin="0,0,15,0">
                            <TextBlock Text="ðŸ“… STAN NA DZIEÅƒ" Style="{StaticResource LabelTextStyle}" FontSize="9"/>
                            <DatePicker SelectedDate="{Binding DataDo}" Style="{StaticResource ModernDatePickerStyle}" Width="120"/>
                        </StackPanel>

                        <StackPanel Margin="0,0,15,0">
                            <TextBlock Text="â±ï¸ SZYBKI FILTR" Style="{StaticResource LabelTextStyle}" FontSize="9"/>
                            <ComboBox ItemsSource="{Binding FiltryDat}" SelectedItem="{Binding WybranyFiltrDaty}"
                                      DisplayMemberPath="Nazwa" Style="{StaticResource ModernComboBoxStyle}" Width="140"/>
                        </StackPanel>

                        <StackPanel Margin="0,0,15,0"
                                    Visibility="{Binding IsAdmin, Converter={StaticResource BoolToVisibilityConverter}}">
                            <TextBlock Text="ðŸ‘¤ HANDLOWIEC" Style="{StaticResource LabelTextStyle}" FontSize="9"/>
                            <ComboBox ItemsSource="{Binding ListaHandlowcow}" SelectedItem="{Binding WybranyHandlowiec}"
                                      Style="{StaticResource ModernComboBoxStyle}" Width="160"/>
                        </StackPanel>
                    </StackPanel>

                    <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                        <Button Style="{StaticResource PrimaryButtonStyle}" Command="{Binding OdswiezCommand}" Margin="0,0,6,0"
                                Background="#2E7D32" Padding="10,6">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="ðŸ”„" FontSize="12" Margin="0,0,4,0"/>
                                <TextBlock Text="OdÅ›wieÅ¼" FontSize="11"/>
                            </StackPanel>
                        </Button>
                        <Button Style="{StaticResource InfoButtonStyle}" Command="{Binding ToggleGrupowanieCommand}" Margin="0,0,6,0"
                                Background="#43A047" Padding="10,6">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="ðŸ“" FontSize="12" Margin="0,0,4,0"/>
                                <TextBlock Text="{Binding TekstGrupowania}" FontSize="11"/>
                            </StackPanel>
                        </Button>
                        <Button Style="{StaticResource InfoButtonStyle}" Command="{Binding EksportPDFCommand}" Margin="0,0,6,0"
                                Background="#66BB6A" Padding="10,6">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="ðŸ“„" FontSize="12" Margin="0,0,4,0"/>
                                <TextBlock Text="PDF" FontSize="11"/>
                            </StackPanel>
                        </Button>
                        <Button Style="{StaticResource InfoButtonStyle}" Command="{Binding EksportExcelCommand}"
                                Background="#81C784" Padding="10,6">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="ðŸ“Š" FontSize="12" Margin="0,0,4,0"/>
                                <TextBlock Text="Excel" FontSize="11"/>
                            </StackPanel>
                        </Button>
                    </StackPanel>
                </Grid>

                <!-- Dolny rzÄ…d: Podsumowanie sald -->
                <Border Grid.Row="1" Margin="0,10,0,0">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- E2 -->
                        <Border Grid.Column="0" Background="#E8F5E9" CornerRadius="6" Padding="10,6" Margin="0,0,8,0" BorderBrush="#2E7D32" BorderThickness="0,0,0,2">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="ðŸ“¦" FontSize="14" VerticalAlignment="Center" Margin="0,0,6,0"/>
                                <StackPanel>
                                    <TextBlock Text="E2" FontSize="9" FontWeight="SemiBold" Foreground="#4CAF50"/>
                                    <TextBlock Text="{Binding SumaE2, Converter={StaticResource SaldoToTextConverter}}"
                                               FontSize="16" FontWeight="Bold"
                                               Foreground="{Binding SumaE2, Converter={StaticResource SaldoToColorConverter}}"/>
                                </StackPanel>
                            </StackPanel>
                        </Border>

                        <!-- H1 -->
                        <Border Grid.Column="1" Background="#C8E6C9" CornerRadius="6" Padding="10,6" Margin="0,0,8,0" BorderBrush="#388E3C" BorderThickness="0,0,0,2">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="ðŸŽ¨" FontSize="14" VerticalAlignment="Center" Margin="0,0,6,0"/>
                                <StackPanel>
                                    <TextBlock Text="H1" FontSize="9" FontWeight="SemiBold" Foreground="#43A047"/>
                                    <TextBlock Text="{Binding SumaH1, Converter={StaticResource SaldoToTextConverter}}"
                                               FontSize="16" FontWeight="Bold"
                                               Foreground="{Binding SumaH1, Converter={StaticResource SaldoToColorConverter}}"/>
                                </StackPanel>
                            </StackPanel>
                        </Border>

                        <!-- Liczba kontrahentÃ³w -->
                        <Border Grid.Column="2" Background="#E3F2FD" CornerRadius="6" Padding="10,6" Margin="0,0,8,0" BorderBrush="#1976D2" BorderThickness="0,0,0,2">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="ðŸ‘¥" FontSize="14" VerticalAlignment="Center" Margin="0,0,6,0"/>
                                <StackPanel>
                                    <TextBlock Text="Kontrahenci" FontSize="9" FontWeight="SemiBold" Foreground="#1976D2"/>
                                    <TextBlock Text="{Binding LiczbaKontrahentow}" FontSize="16" FontWeight="Bold" Foreground="#1565C0"/>
                                </StackPanel>
                            </StackPanel>
                        </Border>

                        <!-- Wyszukiwanie -->
                        <Border Grid.Column="3" Background="White" CornerRadius="6" BorderBrush="#BDBDBD" BorderThickness="1">
                            <Grid>
                                <TextBox x:Name="txtSzukajTop" Text="{Binding FiltrTekstowy, UpdateSourceTrigger=PropertyChanged}"
                                         BorderThickness="0" Background="Transparent" Padding="28,8,8,8" FontSize="12"
                                         VerticalAlignment="Center"/>
                                <TextBlock Text="ðŸ”" FontSize="12" VerticalAlignment="Center" Margin="8,0,0,0" IsHitTestVisible="False"
                                           Foreground="#9E9E9E"/>
                            </Grid>
                        </Border>
                    </Grid>
                </Border>
            </Grid>
        </Border>

        <!-- Stary pasek wyszukiwania usuniÄ™ty - przeniesiony do paska narzÄ™dzi -->

        <!-- ============================================== -->
        <!-- GÅÃ“WNA ZAWARTOÅšÄ† - PEÅNA SZEROKOÅšÄ† -->
        <!-- ============================================== -->
        <Border Grid.Row="2" Style="{StaticResource CardPanel}" Margin="12,6,12,12">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <Border Grid.Row="0" Background="#E8F5E9" CornerRadius="8" Padding="10,6" Margin="0,0,0,8">
                    <Grid>
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="ðŸ“‹" FontSize="14" VerticalAlignment="Center" Margin="0,0,6,0"/>
                            <TextBlock Text="Lista Sald KontrahentÃ³w" FontSize="13" FontWeight="Bold"
                                       Foreground="#1B5E20" VerticalAlignment="Center"/>
                        </StackPanel>
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Center">
                            <CheckBox Content="ðŸ‘¤ Tylko swoi" IsChecked="{Binding PokazujTylkoSwoich}"
                                      Style="{StaticResource ModernCheckBoxStyle}" Margin="0,0,20,0" FontSize="11"/>
                            <TextBlock Text="PPM â†’ Opcje | 2x klik â†’ SzczegÃ³Å‚y" FontSize="9"
                                       Foreground="{StaticResource TextMutedBrush}" FontStyle="Italic"
                                       VerticalAlignment="Center"/>
                        </StackPanel>
                    </Grid>
                </Border>

                <Border Grid.Row="1" BorderBrush="#2E7D32" BorderThickness="2" CornerRadius="8" ClipToBounds="True">
                    <DataGrid x:Name="dataGridSalda"
                              ItemsSource="{Binding SaldaView}"
                              Style="{StaticResource ModernDataGridStyle}"
                              CellStyle="{StaticResource ModernDataGridCellStyle}"
                              MouseDoubleClick="DataGridSalda_MouseDoubleClick">
                        <DataGrid.ColumnHeaderStyle>
                            <Style TargetType="DataGridColumnHeader" BasedOn="{StaticResource ModernDataGridColumnHeaderStyle}">
                                <Setter Property="Background" Value="#2E7D32"/>
                                <Setter Property="BorderBrush" Value="#1B5E20"/>
                            </Style>
                        </DataGrid.ColumnHeaderStyle>
                        <DataGrid.RowStyle>
                            <Style TargetType="DataGridRow" BasedOn="{StaticResource ModernDataGridRowStyle}">
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding SaldoCalkowite, Converter={StaticResource ThresholdConverter}, ConverterParameter=Critical}" Value="True">
                                        <Setter Property="Background" Value="#FFEBEE"/>
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding SaldoCalkowite, Converter={StaticResource ThresholdConverter}, ConverterParameter=Warning}" Value="True">
                                        <Setter Property="Background" Value="#FFF3E0"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </DataGrid.RowStyle>
                        <DataGrid.ContextMenu>
                            <ContextMenu>
                                <MenuItem Header="ðŸ“‹ SzczegÃ³Å‚y kontrahenta" Click="MenuSzczegoly_Click" FontWeight="SemiBold"/>
                                <Separator/>
                                <MenuItem Header="ðŸ“ž ZadzwoÅ„" Click="MenuZadzwon_Click"/>
                                <MenuItem Header="ðŸ“§ WyÅ›lij email" Click="MenuWyslijEmail_Click"/>
                                <Separator/>
                                <MenuItem Header="ðŸ“„ Eksport PDF" Click="MenuEksportPDF_Click"/>
                                <MenuItem Header="ðŸ“Š Eksport Excel" Click="MenuEksportExcel_Click"/>
                            </ContextMenu>
                        </DataGrid.ContextMenu>
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Kontrahent" Binding="{Binding Kontrahent}" Width="*" MinWidth="200"/>
                            <DataGridTextColumn Header="Handlowiec" Binding="{Binding Handlowiec}" Width="120"/>
                            <DataGridTemplateColumn Header="E2" Width="90" SortMemberPath="SaldoE2">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding SaldoE2}" FontWeight="SemiBold" HorizontalAlignment="Right"
                                                   Foreground="{Binding SaldoE2, Converter={StaticResource SaldoToColorConverter}}"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                            <DataGridTemplateColumn Header="H1" Width="90" SortMemberPath="SaldoH1">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding SaldoH1}" FontWeight="SemiBold" HorizontalAlignment="Right"
                                                   Foreground="{Binding SaldoH1, Converter={StaticResource SaldoToColorConverter}}"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                            <!-- EURO, PCV, DREW - UKRYTE -->
                            <DataGridTemplateColumn Header="RAZEM" Width="110" SortMemberPath="SaldoCalkowite">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Border Background="{Binding SaldoCalkowite, Converter={StaticResource SaldoCardBackgroundConverter}}"
                                                CornerRadius="6" Padding="8,2" Margin="-4,0">
                                            <TextBlock Text="{Binding SaldoCalkowite}" FontWeight="Bold" HorizontalAlignment="Center"
                                                       Foreground="{Binding SaldoCalkowite, Converter={StaticResource SaldoToColorConverter}}"/>
                                        </Border>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                            <DataGridTemplateColumn Header="Akcje" Width="80">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Button Style="{StaticResource SmallButtonStyle}" Click="BtnSzczegoly_Click"
                                                ToolTip="Zobacz szczegÃ³Å‚y" Padding="8,4" Background="#2E7D32">
                                            <TextBlock Text="ðŸ‘ï¸" FontSize="14"/>
                                        </Button>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>
                    </DataGrid>
                </Border>
            </Grid>
        </Border>

        <!-- ============================================== -->
        <!-- STOPKA -->
        <!-- ============================================== -->
        <Border Grid.Row="3" Background="White" BorderBrush="#C8E6C9"
                BorderThickness="0,1,0,0" Padding="12,8">
            <Grid>
                <TextBlock Text="ðŸ’¡ F5: OdÅ›wieÅ¼ | Ctrl+G: Grupuj | Ctrl+E: Excel | ESC: Zamknij"
                           FontSize="10" Foreground="{StaticResource TextMutedBrush}" VerticalAlignment="Center"
                           HorizontalAlignment="Left"/>

                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                    <Button Style="{StaticResource PrimaryButtonStyle}" Click="BtnSzczegoly_Click" Margin="0,0,8,0"
                            Background="#2E7D32" Padding="12,6">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="ðŸ‘ï¸" FontSize="12" Margin="0,0,4,0"/>
                            <TextBlock Text="SzczegÃ³Å‚y" FontSize="11"/>
                        </StackPanel>
                    </Button>
                    <Button Content="Zamknij" Style="{StaticResource SecondaryButtonStyle}" Click="CloseButton_Click" Padding="12,6" FontSize="11"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- ============================================== -->
        <!-- LOADING OVERLAY -->
        <!-- ============================================== -->
        <Grid Grid.RowSpan="4" Background="#80FFFFFF"
              Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibilityConverter}}">
            <Border Background="White" CornerRadius="12" Padding="30" HorizontalAlignment="Center" VerticalAlignment="Center">
                <Border.Effect>
                    <DropShadowEffect ShadowDepth="0" Color="#000" Opacity="0.2" BlurRadius="20"/>
                </Border.Effect>
                <StackPanel>
                    <ProgressBar IsIndeterminate="True" Width="200" Height="6" Foreground="#2E7D32"/>
                    <TextBlock Text="â³ Åadowanie danych..." FontSize="14" Foreground="#2E7D32"
                               HorizontalAlignment="Center" Margin="0,15,0,0"/>
                </StackPanel>
            </Border>
        </Grid>
    </Grid>
</Window>
