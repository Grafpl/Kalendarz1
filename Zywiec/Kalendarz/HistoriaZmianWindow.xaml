<Window x:Class="Kalendarz1.Zywiec.Kalendarz.HistoriaZmianWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Historia Zmian - Audyt Systemu"
        Height="700" Width="1200"
        WindowState="Maximized"
        WindowStartupLocation="CenterScreen"
        Background="#ECEFF1"
        FontFamily="Segoe UI">

    <Window.Resources>
        <!-- Style dla DataGrid -->
        <Style x:Key="AuditDataGridStyle" TargetType="DataGrid">
            <Setter Property="AutoGenerateColumns" Value="False"/>
            <Setter Property="IsReadOnly" Value="True"/>
            <Setter Property="SelectionMode" Value="Single"/>
            <Setter Property="AlternatingRowBackground" Value="#F5F5F5"/>
            <Setter Property="GridLinesVisibility" Value="Horizontal"/>
            <Setter Property="HorizontalGridLinesBrush" Value="#E0E0E0"/>
            <Setter Property="BorderBrush" Value="#BDBDBD"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="RowHeight" Value="28"/>
            <Setter Property="ColumnHeaderHeight" Value="32"/>
        </Style>

        <!-- Style dla wiersza DataGrid - lepsze zaznaczenie -->
        <Style TargetType="DataGridRow">
            <Setter Property="Background" Value="Transparent"/>
            <Style.Triggers>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="#FFF3E0"/>
                    <Setter Property="BorderBrush" Value="#FF9800"/>
                    <Setter Property="BorderThickness" Value="0,1,0,1"/>
                </Trigger>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#FFFDE7"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Style dla kom贸rki DataGrid -->
        <Style TargetType="DataGridCell">
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
            <Style.Triggers>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="Transparent"/>
                    <Setter Property="Foreground" Value="Black"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Style dla nag贸wk贸w kolumn -->
        <Style TargetType="DataGridColumnHeader">
            <Setter Property="Background" Value="#455A64"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Padding" Value="8,5"/>
            <Setter Property="BorderBrush" Value="#37474F"/>
            <Setter Property="BorderThickness" Value="0,0,1,0"/>
        </Style>

        <!-- Style dla przycisk贸w -->
        <Style x:Key="FilterButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="#5C8A3A"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Padding" Value="15,8"/>
            <Setter Property="Margin" Value="5,0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" CornerRadius="4" Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#4B732F"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>

    <Grid Margin="15">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- NAGWEK -->
        <Border Grid.Row="0" Background="#455A64" CornerRadius="4" Padding="15,10" Margin="0,0,0,10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <StackPanel>
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="Historia Zmian" FontSize="20" FontWeight="Bold" Foreground="White"/>
                        <TextBlock x:Name="txtFilteredLP" FontSize="20" FontWeight="Bold" Foreground="#81C784" Margin="10,0,0,0"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="Przegldaj wszystkie zmiany dokonane w systemie dostaw" FontSize="12" Foreground="#B0BEC5"/>
                        <TextBlock x:Name="txtFilteredHodowca" FontSize="12" Foreground="#A5D6A7" Margin="10,0,0,0" FontWeight="SemiBold"/>
                    </StackPanel>
                </StackPanel>
                <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBlock Text="Ostatnie odwie偶enie: " Foreground="#B0BEC5" VerticalAlignment="Center"/>
                    <TextBlock x:Name="txtLastRefresh" Text="-" Foreground="White" FontWeight="SemiBold" VerticalAlignment="Center"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- FILTRY -->
        <Border Grid.Row="1" Background="White" CornerRadius="4" Padding="15,10" Margin="0,0,0,10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Filtr LP -->
                <StackPanel Grid.Column="0" Margin="0,0,15,0">
                    <TextBlock Text="LP Dostawy:" FontSize="11" Foreground="#757575" Margin="0,0,0,3"/>
                    <TextBox x:Name="txtFilterLP" Width="100" Height="28" VerticalContentAlignment="Center" Padding="5,0"/>
                </StackPanel>

                <!-- Filtr U偶ytkownik -->
                <StackPanel Grid.Column="1" Margin="0,0,15,0">
                    <TextBlock Text="U偶ytkownik:" FontSize="11" Foreground="#757575" Margin="0,0,0,3"/>
                    <ComboBox x:Name="cmbFilterUser" Width="120" Height="28" VerticalContentAlignment="Center">
                        <ComboBoxItem Content="Wszyscy" IsSelected="True"/>
                    </ComboBox>
                </StackPanel>

                <!-- Filtr Typ Operacji -->
                <StackPanel Grid.Column="2" Margin="0,0,15,0">
                    <TextBlock Text="Typ operacji:" FontSize="11" Foreground="#757575" Margin="0,0,0,3"/>
                    <ComboBox x:Name="cmbFilterOperation" Width="100" Height="28" VerticalContentAlignment="Center">
                        <ComboBoxItem Content="Wszystkie" IsSelected="True"/>
                        <ComboBoxItem Content="INSERT"/>
                        <ComboBoxItem Content="UPDATE"/>
                        <ComboBoxItem Content="DELETE"/>
                    </ComboBox>
                </StackPanel>

                <!-- Filtr Okres -->
                <StackPanel Grid.Column="3" Margin="0,0,15,0">
                    <TextBlock Text="Okres:" FontSize="11" Foreground="#757575" Margin="0,0,0,3"/>
                    <ComboBox x:Name="cmbFilterPeriod" Width="130" Height="28" VerticalContentAlignment="Center" SelectionChanged="CmbFilterPeriod_SelectionChanged">
                        <ComboBoxItem Content="Ostatnie 24h" IsSelected="True" Tag="24"/>
                        <ComboBoxItem Content="Ostatnie 7 dni" Tag="168"/>
                        <ComboBoxItem Content="Ostatnie 30 dni" Tag="720"/>
                        <ComboBoxItem Content="Wasny zakres" Tag="0"/>
                    </ComboBox>
                </StackPanel>

                <!-- Daty Od-Do -->
                <StackPanel Grid.Column="4" Orientation="Horizontal" x:Name="pnlCustomDates" Visibility="Collapsed">
                    <StackPanel Margin="0,0,10,0">
                        <TextBlock Text="Od:" FontSize="11" Foreground="#757575" Margin="0,0,0,3"/>
                        <DatePicker x:Name="dpDateFrom" Width="110" Height="28"/>
                    </StackPanel>
                    <StackPanel>
                        <TextBlock Text="Do:" FontSize="11" Foreground="#757575" Margin="0,0,0,3"/>
                        <DatePicker x:Name="dpDateTo" Width="110" Height="28"/>
                    </StackPanel>
                </StackPanel>

                <!-- Przyciski -->
                <StackPanel Grid.Column="6" Orientation="Horizontal" VerticalAlignment="Bottom">
                    <Button x:Name="btnSearch" Content="Szukaj" Style="{StaticResource FilterButtonStyle}" Click="BtnSearch_Click"/>
                    <Button x:Name="btnClear" Content="Wyczy" Style="{StaticResource FilterButtonStyle}" Background="#78909C" Click="BtnClear_Click"/>
                    <Button x:Name="btnRefresh" Content="Odwie偶" Style="{StaticResource FilterButtonStyle}" Background="#0288D1" Click="BtnRefresh_Click"/>
                    <Button x:Name="btnExport" Content="Eksport CSV" Style="{StaticResource FilterButtonStyle}" Background="#7B1FA2" Click="BtnExport_Click"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- GWNY OBSZAR - PODZIELONY NA DWA -->
        <Grid Grid.Row="2">
            <Grid.RowDefinitions>
                <RowDefinition Height="*"/>
                <RowDefinition Height="5"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- GRNA CZ - HISTORIA ZMIAN -->
            <Border Grid.Row="0" Background="White" CornerRadius="4" Padding="5">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    <TextBlock Grid.Row="0" Text=" HISTORIA ZMIAN DOSTAWY" FontWeight="Bold" FontSize="12" Foreground="#455A64" Margin="5,0,0,5"/>
                    <DataGrid Grid.Row="1" x:Name="dgAuditLog" Style="{StaticResource AuditDataGridStyle}">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Data/Czas" Binding="{Binding DataZmianyFormatted}" Width="140">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="VerticalAlignment" Value="Center"/>
                                        <Setter Property="Padding" Value="5,0"/>
                                        <Setter Property="FontSize" Value="11"/>
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>
                            <DataGridTextColumn Header="U偶ytkownik" Binding="{Binding UserDisplay}" Width="100">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="VerticalAlignment" Value="Center"/>
                                        <Setter Property="Padding" Value="5,0"/>
                                        <Setter Property="FontWeight" Value="SemiBold"/>
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>
                            <DataGridTextColumn Header="LP" Binding="{Binding RekordID}" Width="70">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="VerticalAlignment" Value="Center"/>
                                        <Setter Property="HorizontalAlignment" Value="Center"/>
                                        <Setter Property="FontWeight" Value="Bold"/>
                                        <Setter Property="Foreground" Value="#1976D2"/>
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>
                            <DataGridTextColumn Header="Operacja" Binding="{Binding TypOperacjiDisplay}" Width="80">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="VerticalAlignment" Value="Center"/>
                                        <Setter Property="HorizontalAlignment" Value="Center"/>
                                        <Setter Property="Padding" Value="5,2"/>
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>
                            <DataGridTextColumn Header="殴r贸do" Binding="{Binding ZrodloZmianyDisplay}" Width="130">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="VerticalAlignment" Value="Center"/>
                                        <Setter Property="Padding" Value="5,0"/>
                                        <Setter Property="FontSize" Value="11"/>
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>
                            <DataGridTextColumn Header="Pole" Binding="{Binding NazwaPolaDisplay}" Width="100">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="VerticalAlignment" Value="Center"/>
                                        <Setter Property="Padding" Value="5,0"/>
                                        <Setter Property="FontWeight" Value="SemiBold"/>
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>
                            <DataGridTemplateColumn Header="Stara warto" Width="Auto">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Border Background="#FFEBEE" CornerRadius="3" Margin="2" Padding="4,2"
                                                ToolTip="{Binding StaraWartosc}">
                                            <TextBlock Text="{Binding StaraWartosc}"
                                                       Foreground="#C62828" FontWeight="SemiBold"
                                                       VerticalAlignment="Center"/>
                                        </Border>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                            <DataGridTemplateColumn Header="Nowa warto" Width="Auto">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Border Background="#E8F5E9" CornerRadius="3" Margin="2" Padding="4,2"
                                                ToolTip="{Binding NowaWartosc}">
                                            <TextBlock Text="{Binding NowaWartosc}"
                                                       Foreground="#2E7D32" FontWeight="SemiBold"
                                                       VerticalAlignment="Center"/>
                                        </Border>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                            <DataGridTextColumn Header="Opis" Binding="{Binding OpisZmiany}" Width="*">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="VerticalAlignment" Value="Center"/>
                                        <Setter Property="Padding" Value="5,0"/>
                                        <Setter Property="TextTrimming" Value="CharacterEllipsis"/>
                                        <Setter Property="ToolTip" Value="{Binding OpisZmiany}"/>
                                        <Setter Property="FontSize" Value="11"/>
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>
            </Border>

            <!-- SEPARATOR -->
            <GridSplitter Grid.Row="1" Height="5" HorizontalAlignment="Stretch" Background="#ECEFF1" Cursor="SizeNS"/>

            <!-- DOLNA CZ - HISTORIA NOTATEK -->
            <Border Grid.Row="2" Background="White" CornerRadius="4" Padding="5">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="5,0,0,5">
                        <TextBlock Text=" HISTORIA NOTATEK" FontWeight="Bold" FontSize="12" Foreground="#455A64"/>
                        <TextBlock x:Name="txtNotatkiCount" FontSize="12" Foreground="#78909C" Margin="10,0,0,0"/>
                    </StackPanel>
                    <DataGrid Grid.Row="1" x:Name="dgNotatki" Style="{StaticResource AuditDataGridStyle}" RowHeight="Auto">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Data utworzenia" Binding="{Binding DataUtworzenia, StringFormat=yyyy-MM-dd HH:mm}" Width="140">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="VerticalAlignment" Value="Center"/>
                                        <Setter Property="Padding" Value="5,0"/>
                                        <Setter Property="FontSize" Value="11"/>
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>
                            <DataGridTextColumn Header="Autor" Binding="{Binding KtoDodal}" Width="120">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="VerticalAlignment" Value="Center"/>
                                        <Setter Property="Padding" Value="5,0"/>
                                        <Setter Property="FontWeight" Value="SemiBold"/>
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>
                            <DataGridTextColumn Header="Tre notatki" Binding="{Binding Tresc}" Width="*">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="VerticalAlignment" Value="Center"/>
                                        <Setter Property="Padding" Value="5,4"/>
                                        <Setter Property="TextWrapping" Value="Wrap"/>
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>
                            <DataGridTextColumn Header="Data modyfikacji" Binding="{Binding DataModyfikacji, StringFormat=yyyy-MM-dd HH:mm}" Width="140">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="VerticalAlignment" Value="Center"/>
                                        <Setter Property="Padding" Value="5,0"/>
                                        <Setter Property="FontSize" Value="10"/>
                                        <Setter Property="Foreground" Value="#78909C"/>
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>
            </Border>
        </Grid>

        <!-- STOPKA -->
        <Border Grid.Row="3" Background="#455A64" CornerRadius="4" Padding="15,8" Margin="0,10,0,0">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="Wynik贸w: " Foreground="#B0BEC5" VerticalAlignment="Center"/>
                    <TextBlock x:Name="txtResultCount" Text="0" Foreground="White" FontWeight="Bold" VerticalAlignment="Center" Margin="0,0,20,0"/>
                    <TextBlock x:Name="txtStatusInfo" Text="" Foreground="#B0BEC5" VerticalAlignment="Center"/>
                </StackPanel>
                <Button Grid.Column="1" x:Name="btnClose" Content="Zamknij" Style="{StaticResource FilterButtonStyle}" Background="#546E7A" Click="BtnClose_Click"/>
            </Grid>
        </Border>
    </Grid>
</Window>
