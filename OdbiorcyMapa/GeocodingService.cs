// =============== GeocodingService.cs - ULEPSZONE GEOKODOWANIE ===============
using Newtonsoft.Json;
using System;
using System.Collections.Generic;
using System.Globalization;
using System.Net.Http;
using System.Linq;
using System.Threading.Tasks;
using System.Text.RegularExpressions;

namespace Kalendarz1
{
    public class GeocodingService
    {
        private readonly HttpClient httpClient;
        private readonly Dictionary<string, (double lat, double lng)> fallbackCoordinates;

        public GeocodingService()
        {
            httpClient = new HttpClient();
            httpClient.DefaultRequestHeaders.Add("User-Agent", "MapaOdbiorcow/1.0 (Windows NT; .NET)");
            httpClient.DefaultRequestHeaders.Add("Accept-Language", "pl-PL,pl;q=0.9,en;q=0.8");
            httpClient.Timeout = TimeSpan.FromSeconds(30);

            fallbackCoordinates = new Dictionary<string, (double lat, double lng)>(StringComparer.OrdinalIgnoreCase)
            {
                // Województwo łódzkie
                { "Łódź", (51.759445, 19.457216) },
                { "Zgierz", (51.8547, 19.4064) },
                { "Pabianice", (51.6647, 19.3547) },
                { "Stryków", (51.9014, 19.6106) },
                { "Głowno", (51.9642, 19.7164) },
                { "Brzeziny", (51.7992, 19.7514) },
                { "Rawa Mazowiecka", (51.7644, 20.2547) },
                { "Skierniewice", (51.9544, 20.1469) },
                { "Konstantynów Łódzki", (51.7478, 19.3256) },
                { "Aleksandrów Łódzki", (51.8142, 19.3036) },
                { "Ozorków", (51.9631, 19.2914) },
                { "Łask", (51.5906, 19.1328) },
                { "Zduńska Wola", (51.5992, 18.9397) },
                { "Sieradz", (51.5956, 18.7303) },
                { "Wieluń", (51.2208, 18.5697) },
                { "Bełchatów", (51.3689, 19.3567) },
                { "Piotrków Trybunalski", (51.4053, 19.7033) },
                { "Tomaszów Mazowiecki", (51.5311, 20.0086) },
                { "Opoczno", (51.3758, 20.2894) },
                { "Kutno", (52.2308, 19.3614) },
                { "Łowicz", (52.1072, 19.9453) },
                { "Łęczyca", (52.0597, 19.1997) },
                { "Poddębice", (51.8931, 18.9569) },
                { "Radomsko", (51.0669, 19.4447) },
                { "Wieruszów", (51.2944, 18.1531) },
                { "Pajęczno", (51.1436, 18.9944) },
                
                // Miejscowości w okolicy
                { "Andrespol", (51.7264, 19.6414) },
                { "Koluszki", (51.7383, 19.8356) },
                { "Tuszyn", (51.6058, 19.5289) },
                { "Rzgów", (51.6656, 19.4892) },
                { "Ksawerów", (51.7358, 19.4036) },
                { "Lutomiersk", (51.7508, 19.2011) },
                { "Dobroń", (51.6206, 19.2461) },
                { "Drużbice", (51.4547, 19.4033) },
                { "Gorzkowice", (51.2119, 19.6269) },
                { "Kamieńsk", (51.2033, 19.4967) },
                { "Kluki", (51.3397, 19.5594) },
                { "Kleszczów", (51.2222, 19.3036) },
                { "Lgota Wielka", (51.1833, 19.3833) },
                { "Masłowice", (51.4939, 19.2911) },
                { "Moszczenica", (51.5044, 19.7269) },
                { "Ręczno", (51.2633, 19.8947) },
                { "Rozprza", (51.3019, 19.6456) },
                { "Sulmierzyce", (51.1792, 18.9569) },
                { "Szczerców", (51.3331, 19.1047) },
                { "Ujazd", (51.5925, 20.0542) },
                { "Wolbórz", (51.5006, 19.8339) },
                { "Zelów", (51.4653, 19.2203) },
                
                // Województwo mazowieckie
                { "Warszawa", (52.229676, 21.012229) },
                { "Radom", (51.4027, 21.1471) },
                { "Płock", (52.5463, 19.7065) },
                { "Siedlce", (52.1672, 22.2900) },
                { "Pruszków", (52.1708, 20.8125) },
                { "Ostrołęka", (53.0869, 21.5690) },
                { "Legionowo", (52.4017, 20.9267) },
                { "Ciechanów", (52.8814, 20.6197) },
                { "Żyrardów", (52.0489, 20.4456) },
                { "Piaseczno", (52.0814, 21.0247) },
                { "Otwock", (52.1056, 21.2611) },
                { "Wołomin", (52.3400, 21.2419) },
                { "Mińsk Mazowiecki", (52.1792, 21.5722) },
                { "Sochaczew", (52.2292, 20.2381) },
                { "Grodzisk Mazowiecki", (52.1064, 20.6336) },
                { "Nowy Dwór Mazowiecki", (52.4300, 20.7167) },
                { "Gostynin", (52.4264, 19.4617) },
                { "Płońsk", (52.6233, 20.3761) },
                { "Pułtusk", (52.7017, 21.0861) },
                { "Wyszków", (52.5931, 21.4581) },
                { "Kozienice", (51.5828, 21.5478) },
                { "Sierpc", (52.8564, 19.6686) },
                { "Garwolin", (51.8975, 21.6147) },
                { "Węgrów", (52.4006, 22.0158) },
                { "Sokołów Podlaski", (52.4067, 22.2531) },
                { "Białobrzegi", (51.6500, 20.9500) },
                { "Góra Kalwaria", (52.0808, 21.2167) },
                { "Konstancin-Jeziorna", (52.0936, 21.1178) },
                { "Józefów", (52.1375, 21.2342) },
                { "Marki", (52.3211, 21.1050) },
                { "Ząbki", (52.2931, 21.1053) },
                { "Kobyłka", (52.3394, 21.1950) },
                { "Zielonka", (52.3033, 21.1600) },
                { "Sulejówek", (52.2531, 21.2689) },
                { "Halinów", (52.2225, 21.3514) },
                { "Łomianki", (52.3336, 20.8886) },
                { "Błonie", (52.1981, 20.6172) },
                { "Milanówek", (52.1256, 20.6650) },
                { "Podkowa Leśna", (52.1217, 20.7289) },
                { "Brwinów", (52.1431, 20.7172) },
                { "Karczew", (52.0769, 21.2478) },
                { "Góra Kalwaria", (52.0808, 21.2167) },
                { "Tarczyn", (51.9817, 20.8333) },
                { "Grójec", (51.8653, 20.8672) },
                { "Warka", (51.7847, 21.1903) },
                { "Mszczonów", (51.9736, 20.5206) },
                { "Radziejowice", (52.0000, 20.5500) },
                { "Puszcza Mariańska", (52.0000, 20.3500) },
                { "Żabia Wola", (52.0353, 20.6936) },
                { "Nadarzyn", (52.0906, 20.8069) },
                { "Raszyn", (52.1569, 20.9219) },
                { "Michałowice", (52.1686, 20.8828) },
                { "Stare Babice", (52.2575, 20.8367) },
                { "Izabelin", (52.3089, 20.8206) },
                { "Leszno", (52.2611, 20.7256) },
                { "Kampinos", (52.2706, 20.5464) },
                { "Brochów", (52.3194, 20.2625) },
                { "Leoncin", (52.3997, 20.4578) },
                { "Czosnów", (52.4078, 20.7019) },
                { "Zakroczym", (52.4333, 20.6167) },
                { "Pomiechówek", (52.4764, 20.7367) },
                { "Nasielsk", (52.5897, 20.8050) },
                { "Świercze", (52.6189, 20.9503) },
                { "Winnica", (52.6322, 21.0156) },
                { "Serock", (52.5108, 21.0694) },
                { "Nieporęt", (52.4297, 21.0411) },
                { "Wieliszew", (52.4578, 20.9689) },
                { "Jabłonna", (52.3736, 20.9219) },
                { "Radzymin", (52.4147, 21.1847) },
                { "Dąbrówka", (52.3861, 21.3456) },
                { "Klembów", (52.4006, 21.3019) },
                { "Poświętne", (52.3578, 21.1247) },
                { "Tłuszcz", (52.4306, 21.4361) },
                { "Jadów", (52.4703, 21.6408) },
                { "Strachówka", (52.5244, 21.5217) },
                { "Łochów", (52.5308, 21.6819) },
                { "Sadowne", (52.6433, 21.8569) },
                { "Stoczek", (52.5650, 21.9711) },
                { "Kosów Lacki", (52.5939, 22.1506) },
                { "Repki", (52.4442, 22.2978) },
                { "Mordy", (52.2100, 22.5153) },
                { "Zbuczyn", (52.0961, 22.4239) },
                { "Kotuń", (52.0789, 22.0778) },
                { "Mokobody", (52.2550, 22.0411) },
                { "Suchożebry", (52.2558, 22.2506) },
                { "Wodynie", (51.9353, 22.0172) },
                { "Dobre", (52.3450, 21.9728) },
                { "Stanisławów", (52.2883, 21.5506) },
                { "Dębe Wielkie", (52.2058, 21.4569) },
                { "Cegłów", (52.1544, 21.7425) },
                { "Mrozy", (52.1244, 21.8364) },
                { "Latowicz", (52.0522, 21.7897) },
                { "Siennica", (52.0875, 21.6064) },
                { "Parysów", (51.9728, 21.7264) },
                { "Pilawa", (51.9597, 21.5292) },
                { "Osieck", (52.0169, 21.4300) },
                { "Sobienie-Jeziory", (51.9264, 21.2950) },
                { "Celestynów", (52.0522, 21.3900) },
                { "Wiązowna", (52.1797, 21.3706) },
                { "Kołbiel", (52.0644, 21.4814) },
                { "Sienno", (51.1361, 21.0642) },
                { "Przyłęk", (51.3597, 20.9967) },
                { "Wieniawa", (51.4478, 21.0133) },
                { "Kowala", (51.3292, 21.1094) },
                { "Wierzbica", (51.2764, 21.0031) },
                { "Wolanów", (51.3808, 21.0625) },
                { "Zakrzew", (51.4556, 21.2578) },
                { "Jedlnia-Letnisko", (51.4114, 21.2614) },
                { "Pionki", (51.4764, 21.4503) },
                { "Jedlińsk", (51.5133, 21.1272) },
                { "Przytyk", (51.4672, 20.9033) },
                { "Potworów", (51.4889, 20.7833) },
                { "Stromiec", (51.7597, 21.1908) },
                { "Promna", (51.7181, 21.2836) },
                { "Przybyszew", (51.7889, 21.2906) },
                { "Magnuszew", (51.6736, 21.4003) },
                { "Głowaczów", (51.6261, 21.5453) },
                { "Grabów nad Pilicą", (51.6447, 21.6583) },
                { "Warka", (51.7847, 21.1903) },
                { "Jasieniec", (51.8356, 20.9339) },
                { "Chynów", (51.8975, 20.9336) },
                { "Pniewy", (51.9139, 20.8556) },
                { "Prażmów", (51.9389, 20.9589) },
                { "Lesznowola", (52.0931, 20.9275) },
                { "Magdalenka", (52.0581, 20.9808) },
                { "Belsk Duży", (51.8275, 20.7897) },
                { "Błędów", (51.7786, 20.6981) },
                { "Mogielnica", (51.6947, 20.7208) },
                { "Nowe Miasto nad Pilicą", (51.6189, 20.5783) },
                { "Wyszogród", (52.3883, 20.1917) },
                { "Czerwińsk nad Wisłą", (52.3986, 20.3025) },
                { "Bodzanów", (52.5033, 19.9461) },
                { "Słubice", (52.5858, 19.9528) },
                { "Mała Wieś", (52.4569, 19.8611) },
                { "Słupno", (52.5619, 19.5919) },
                { "Radzanowo", (52.5206, 19.8056) },
                { "Bulkowo", (52.4000, 19.8244) },
                { "Stara Biała", (52.5561, 19.5683) },
                { "Brudzeń Duży", (52.4092, 19.8761) },
                { "Staroźreby", (52.4528, 20.0033) },
                { "Drobin", (52.7364, 19.9878) },
                { "Raciąż", (52.7742, 20.1172) },
                { "Baboszewo", (52.6825, 20.2533) },
                { "Glinojeck", (52.8203, 20.2886) },
                { "Strzegowo", (52.9044, 20.2764) },
                { "Szreńsk", (52.9786, 20.1233) },
                { "Bieżuń", (52.9611, 19.8875) },
                { "Lutocin", (52.8506, 19.6583) },
                { "Żuromin", (53.0656, 19.9094) },
                { "Siemiątkowo", (53.0933, 19.8719) },
                { "Lubowidz", (53.1903, 19.9331) },
                { "Lidzbark", (53.2631, 19.8261) },
                { "Bartniczka", (53.2467, 19.6172) },
                { "Górzno", (53.1969, 19.6403) },
                { "Rybno", (53.3889, 19.9389) },
                { "Działdowo", (53.2319, 20.1847) },
                { "Iłowo", (53.1708, 20.3339) },
                { "Płośnica", (53.3056, 20.2453) },
                { "Dzierzgowo", (52.9939, 20.6761) },
                { "Wieczfnia Kościelna", (52.8375, 20.5953) },
                { "Kuczbork-Osada", (53.0089, 20.4464) },
                { "Szydłowo", (52.9508, 20.8636) },
                { "Wiśniewo", (52.7761, 20.7503) },
                { "Regimin", (52.7625, 20.8972) },
                { "Stupsk", (52.8069, 20.9528) },
                { "Gołymin-Ośrodek", (52.8036, 20.8753) },
                { "Rzekuń", (53.0503, 21.6358) },
                { "Lelis", (53.1628, 21.9164) },
                { "Olszewo-Borki", (53.2219, 21.7306) },
                { "Baranowo", (53.2036, 21.5375) },
                { "Czarnia", (53.1731, 21.3856) },
                { "Kadzidło", (53.2367, 21.4594) },
                { "Łyse", (53.3653, 21.5717) },
                { "Myszyniec", (53.3811, 21.3461) },
                { "Rozogi", (53.4106, 21.3903) },
                { "Jednorożec", (53.1336, 21.0867) },
                { "Przasnysz", (53.0192, 20.8806) },
                { "Krasnosielc", (53.0783, 21.2058) },
                { "Płoniawy-Bramura", (52.9819, 21.3003) },
                { "Szelków", (52.8900, 21.1750) },
                { "Chorzele", (53.2606, 20.8958) },
                { "Janowo", (53.3431, 20.7167) },
                { "Janowiec Kościelny", (53.3033, 20.6453) },
                { "Nidzica", (53.3603, 20.4272) },
                { "Kozłowo", (53.4781, 20.4058) },
                { "Krzynowłoga Mała", (52.9747, 20.9461) },
                { "Karniewo", (52.9483, 21.0989) },
                { "Krasne", (52.9711, 21.0067) },
                { "Sypniewo", (52.8817, 21.1119) },
                { "Maków Mazowiecki", (52.8653, 21.1031) },
                { "Czerwonka", (52.9086, 21.2600) },
                { "Młynarze", (52.9031, 21.0086) },
                { "Różan", (52.8875, 21.3958) },
                { "Somianka", (52.6797, 21.5383) },
                { "Zaręby Kościelne", (52.7483, 21.5589) },
                { "Nur", (52.6661, 22.3106) },
                { "Boguty-Pianki", (52.6994, 22.1353) },
                { "Szulborze Wielkie", (52.7569, 22.0819) },
                { "Andrzejewo", (52.7992, 22.0733) },
                { "Zaręby", (52.7636, 21.9406) },
                { "Brok", (52.6983, 21.8583) },
                { "Małkinia Górna", (52.6925, 22.0283) },
                { "Ostrów Mazowiecka", (52.8022, 21.8953) },
                { "Wąsewo", (52.8631, 21.8164) },
                { "Długosiodło", (52.7764, 21.6308) },
                { "Brańszczyk", (52.6456, 21.5806) },
                { "Rząśnik", (52.6008, 21.5311) },
                { "Zabrodzie", (52.6428, 21.4533) },
                { "Niegów", (52.7175, 21.0353) },
                { "Gzy", (52.7353, 20.9531) },
                { "Pokrzywnica", (52.6839, 21.0731) },
                { "Zatory", (52.5544, 21.1042) },
                { "Pułtusk", (52.7017, 21.0861) },
                { "Obryte", (52.6225, 21.1364) },
                { "Świercze", (52.6189, 20.9503) },
                { "Winnica", (52.6322, 21.0156) },
                { "Somianka", (52.6797, 21.5383) },
                { "Karniewo", (52.9483, 21.0989) },
                { "Gołymin-Ośrodek", (52.8036, 20.8753) },
                { "Sońsk", (52.7869, 20.7086) },
                { "Nowe Miasto", (52.6569, 20.5792) },
                { "Joniec", (52.6000, 20.6403) },
                { "Ojrzeń", (52.8375, 20.4414) },
                { "Sochocin", (52.7119, 20.4261) },
                { "Załuski", (52.6303, 20.4050) },
                { "Kuczbork-Osada", (53.0089, 20.4464) },
                { "Smoszewo", (52.5603, 20.4569) },
                { "Zakroczym", (52.4333, 20.6167) },
                { "Bieżuń", (52.9611, 19.8875) },
                { "Gozdowo", (52.8528, 19.5600) },
                { "Mochowo", (52.7811, 19.5631) },
                { "Skępe", (52.8686, 19.3533) },
                { "Strzegowo", (52.9044, 20.2764) },
                { "Kuczbork-Osada", (53.0089, 20.4464) },
                { "Lipowiec Kościelny", (52.8861, 20.1042) },
                { "Radzanów", (51.6869, 21.6486) },
                { "Stara Kornica", (52.2203, 22.9525) },
                { "Huszlew", (52.1639, 22.8978) },
                { "Łosice", (52.2111, 22.7181) },
                { "Platerów", (52.2567, 22.7319) },
                { "Olszanka", (52.1756, 22.5858) },
                { "Sarnaki", (52.3150, 22.8903) },
                { "Korczew", (52.3703, 23.0242) },
                { "Paprotnia", (52.2944, 22.5647) },
                { "Przesmyki", (52.1164, 22.3519) },
                { "Domanice", (52.0192, 22.2344) },
                { "Wiśniew", (52.0931, 22.2844) },
                { "Skórzec", (52.1081, 22.2344) },
                { "Korytnica", (52.2522, 21.8286) },
                { "Górzno", (52.1956, 21.8633) },
                { "Trojanów", (51.9717, 21.8506) },
                { "Żelechów", (51.8108, 21.8972) },
                { "Borowie", (51.9028, 21.9506) },
                { "Wilga", (51.8886, 21.3861) },
                { "Maciejowice", (51.7019, 21.5494) },
                { "Sobolew", (51.5942, 21.9097) },
                { "Łaskarzew", (51.7906, 21.5911) },
                { "Stoczek Łukowski", (51.9617, 21.9711) },
                { "Krzywda", (51.7469, 22.1611) },
                { "Trzebieszów", (51.9878, 22.5556) },
                { "Wojcieszków", (51.7675, 22.2556) },
                { "Miłosna", (52.1733, 21.1631) },
                { "Ożarów Mazowiecki", (52.2097, 20.7989) },
                { "Babice Nowe", (52.2653, 20.8044) },
                { "Piastów", (52.1833, 20.8372) },
                { "Michałowice-Osiedle", (52.1672, 20.8639) },
                { "Reguły", (52.1072, 20.8631) },
                { "Komorów", (52.1492, 20.8069) },
                { "Nowa Iwiczna", (52.0750, 20.9808) },
                { "Józefosław", (52.1039, 21.0344) },
                { "Julianów", (52.1089, 21.0556) },
                { "Mysiadło", (52.0667, 21.0344) },
                { "Konstancin-Jeziorna", (52.0936, 21.1178) },
                { "Słomczyn", (52.0783, 21.1586) },
                { "Baniocha", (52.0186, 20.8622) },
                { "Góra Kalwaria", (52.0808, 21.2167) },
                { "Czersk", (52.1192, 21.0144) },
                { "Bobrowiec", (52.0381, 21.0422) },
                { "Ustanów", (52.0667, 20.9889) },
                { "Złotokłos", (52.1172, 21.0156) },
                { "Piaseczno", (52.0814, 21.0247) },
                { "Głosków", (52.0444, 21.0419) },
                { "Runów", (52.0283, 21.0247) },
                { "Wólka Kosowska", (52.0517, 20.9839) },
                { "Baszkówka", (52.0528, 20.9528) },
                { "Antoninów", (52.0372, 20.9828) },
                { "Łazy", (52.0619, 20.9583) },
                { "Kajetany", (52.0708, 20.9406) },
                { "Siedliska", (52.0761, 20.9161) },
                { "Żabieniec", (52.0878, 20.9117) },
                { "Zgorzała", (52.0778, 20.8917) },
                { "Pęcice", (52.1256, 20.7708) },
                { "Sokołów", (52.1058, 20.7422) },
                { "Duchnice", (52.0836, 20.7439) },
                { "Helenów", (52.1153, 20.6925) },
                { "Parzniew", (52.1431, 20.6650) },
                { "Książenice", (52.0958, 20.7022) },
                { "Otrębusy", (52.1236, 20.7542) },
                { "Kanie", (52.1631, 20.7983) },
                { "Mościska", (52.1839, 20.8258) },
                { "Granica", (52.1922, 20.8603) },
                { "Opacz Mała", (52.1792, 20.8806) },
                { "Opacz Kolonia", (52.1728, 20.8864) },
                { "Reguły", (52.1072, 20.8631) },
                { "Pęcice Małe", (52.1158, 20.7756) },
                { "Suchy Las", (52.1336, 20.7903) },
                { "Falenty", (52.1328, 20.9319) },
                { "Raszyn", (52.1569, 20.9219) },
                { "Rybie", (52.1483, 20.9403) },
                { "Dawidy", (52.1456, 20.9608) },
                { "Dawidy Bankowe", (52.1428, 20.9561) },
                { "Podolszyn", (52.1492, 20.9747) },
                { "Nowy Podolszyn", (52.1522, 20.9806) },
                { "Łoś", (52.1569, 20.9983) },
                { "Sękocin Stary", (52.1183, 20.9058) },
                { "Sękocin Nowy", (52.1108, 20.8947) },
                { "Sękocin-Las", (52.1039, 20.8922) },
                { "Wólka Pracka", (52.1381, 20.8486) },
                { "Komorniki", (52.1303, 20.8228) },
                { "Komorniki-Wieś", (52.1303, 20.8228) },
                { "Graniczna Wieś", (52.1439, 20.8278) },
                { "Sokołowska Wola", (52.1569, 20.8433) },
                { "Puchały", (52.1672, 20.8139) },
                { "Hornówek", (52.1850, 20.7842) },
                { "Klaudyn", (52.2433, 20.7917) },
                { "Kwirynów", (52.2322, 20.8039) },
                { "Koczargi Stare", (52.2522, 20.8208) },
                { "Koczargi Nowe", (52.2569, 20.8286) },
                { "Lipków", (52.2664, 20.8442) },
                { "Wojcieszyn", (52.2817, 20.8497) },
                { "Zaborów", (52.2506, 20.8678) },
                { "Zaborówek", (52.2478, 20.8783) },
                { "Buda", (52.2383, 20.8919) },
                { "Blizne Jasińskiego", (52.2281, 20.8736) },
                { "Blizne Łaszczyńskiego", (52.2317, 20.8833) },
                { "Wierzbin", (52.2394, 20.8633) },
                { "Radiówek", (52.2583, 20.8558) },
                { "Mariew", (52.2725, 20.8786) },
                { "Borzęcin Duży", (52.2853, 20.8544) },
                { "Borzęcin Mały", (52.2861, 20.8417) },
                { "Truskaw", (52.2989, 20.8350) },
                { "Sieraków", (52.3061, 20.8528) },
                { "Izabelin C", (52.2931, 20.8183) },
                { "Izabelin B", (52.2942, 20.8286) },
                { "Laski", (52.2972, 20.8444) },
                { "Mościska", (52.2850, 20.8083) },
                { "Hornówek", (52.2850, 20.7883) },
                { "Stanisławów", (52.2883, 21.5506) },
                
                // Województwo wielkopolskie
                { "Poznań", (52.406374, 16.925168) },
                { "Kalisz", (51.7677, 18.0860) },
                { "Konin", (52.2230, 18.2511) },
                { "Piła", (53.1511, 16.7382) },
                { "Ostrów Wielkopolski", (51.6550, 17.8069) },
                { "Gniezno", (52.5349, 17.5827) },
                { "Leszno", (51.8419, 16.5938) },
                { "Krotoszyn", (51.6988, 17.4373) },
                { "Turek", (52.0153, 18.5008) },
                { "Kępno", (51.2785, 17.9882) },
                { "Września", (52.3253, 17.5652) },
                { "Śrem", (52.0886, 17.0150) },
                { "Jarocin", (51.9726, 17.5026) },
                { "Kościan", (52.0792, 16.6478) },
                { "Wągrowiec", (52.8082, 17.1997) },
                { "Gostyń", (51.8823, 17.0122) },
                { "Chodzież", (52.9985, 16.9197) },
                { "Pleszew", (51.8964, 17.7857) },
                { "Złotów", (53.3594, 17.0407) },
                { "Nowy Tomyśl", (52.3198, 16.1284) },
                { "Rawicz", (51.6094, 16.8585) },
                { "Grodzisk Wielkopolski", (52.2281, 16.3675) },
                { "Czarnków", (52.9021, 16.5641) },
                { "Szamotuły", (52.6120, 16.5779) },
                { "Międzychód", (52.5984, 15.8970) },
                { "Trzcianka", (53.0406, 16.4561) },
                { "Oborniki", (52.6476, 16.8134) },
                { "Koło", (52.2003, 18.6386) },
                { "Słupca", (52.2872, 17.8719) },
                { "Środa Wielkopolska", (52.2292, 17.2764) },
                { "Witkowo", (52.4389, 17.7721) },
                { "Wolsztyn", (52.1181, 16.1133) },
                { "Kórnik", (52.2471, 17.0895) },
                { "Kostrzyn", (52.3979, 17.2283) },
                { "Pobiedziska", (52.4772, 17.2877) },
                { "Murowana Goślina", (52.5736, 16.9953) },
                { "Swarzędz", (52.4127, 17.0852) },
                { "Luboń", (52.3460, 16.8879) },
                { "Mosina", (52.2454, 16.8472) },
                { "Stęszew", (52.2838, 16.7008) },
                { "Puszczykowo", (52.2866, 16.8496) },
                { "Buk", (52.3547, 16.5202) },
                { "Dopiewo", (52.3532, 16.6383) },
                { "Tarnowo Podgórne", (52.4660, 16.6602) },
                { "Rokietnica", (52.5075, 16.7407) },
                { "Suchy Las", (52.4736, 16.8756) },
                { "Czerwonak", (52.4636, 16.9815) },
                { "Kleczew", (52.3719, 18.1783) },
                { "Sompolno", (52.3889, 18.5028) },
                { "Ślesin", (52.3703, 18.3072) },
                { "Rychwał", (52.0692, 18.1644) },
                { "Golina", (52.2431, 18.0923) },
                { "Zagórów", (52.1689, 17.8975) },
                { "Pyzdry", (52.1697, 17.6897) },
                { "Kłodawa", (52.2544, 18.9144) },
                { "Dąbie", (52.1039, 18.8208) },
                { "Grzegorzew", (52.2136, 18.7322) },
                { "Olszówka", (52.2075, 18.8414) },
                { "Przedecz", (52.3356, 18.9006) },
                { "Chodów", (52.0947, 18.9703) },
                { "Władysławów", (52.1178, 19.0461) },
                { "Tuliszków", (52.0778, 18.2947) },
                { "Brudzew", (52.1108, 18.5992) },
                { "Dobra", (52.0847, 18.6144) },
                { "Kawęczyn", (52.0119, 18.5297) },
                { "Malanów", (52.0475, 18.6036) },
                { "Przykona", (51.9944, 18.6372) },
                { "Turek", (52.0153, 18.5008) },
                { "Turkowice", (51.9753, 18.5156) },
                { "Władysławów", (52.1178, 19.0461) },
                { "Russów", (51.9856, 18.8506) },
                { "Żelazków", (51.8514, 17.7697) },
                { "Gołuchów", (51.8483, 17.9333) },
                { "Jedlec", (51.7397, 17.8008) },
                { "Kuźnica Grabowska", (51.9039, 17.8639) },
                { "Odolanów", (51.5742, 17.6739) },
                { "Przygodzice", (51.5933, 17.8222) },
                { "Antonin", (51.5194, 17.8497) },
                { "Mikstat", (51.5322, 17.9747) },
                { "Ostrzeszów", (51.4264, 17.9333) },
                { "Doruchów", (51.4158, 18.0786) },
                { "Grabów nad Prosną", (51.5083, 18.1189) },
                { "Kobyla Góra", (51.4033, 18.2489) },
                { "Mąkoszyce", (51.4711, 18.2922) },
                { "Kraszewice", (51.5153, 18.2239) },
                { "Czajków", (51.4894, 18.0322) },
                { "Siedlików", (51.3525, 17.9922) },
                { "Trzcinica", (51.2947, 18.2792) },
                { "Perzów", (51.2764, 17.9072) },
                { "Turkowy", (51.2922, 17.8292) },
                { "Bralin", (51.2897, 17.7522) },
                { "Baranów", (51.2617, 17.6647) },
                { "Łęka Opatowska", (51.2211, 17.7861) },
                { "Rychtal", (51.1433, 17.8500) },
                { "Wielowieś", (51.1842, 17.5786) },
                { "Koźminiec", (51.7872, 17.4453) },
                { "Rozdrażew", (51.7792, 17.5033) },
                { "Koźmin Wielkopolski", (51.8311, 17.4531) },
                { "Borzęciczki", (51.8544, 17.3917) },
                { "Wyszki", (51.9014, 17.4303) },
                { "Pogorzela", (51.8447, 17.2361) },
                { "Pępowo", (51.7658, 17.1211) },
                { "Krobi", (51.7706, 17.2347) },
                { "Pudliszki", (51.7858, 17.1772) },
                { "Poniec", (51.7606, 16.8097) },
                { "Dzieżkowice", (51.7522, 16.9306) },
                { "Łagiewniki Kościelne", (51.8164, 16.8542) },
                { "Krzemieniewo", (51.7094, 16.8217) },
                { "Pawłowice", (51.6689, 16.7761) },
                { "Belęcin", (51.6544, 16.7967) },
                { "Garzyn", (51.6281, 16.8597) },
                { "Dłoń", (51.6606, 16.9433) },
                { "Gołanice", (51.7011, 16.9825) },
                { "Borek Wielkopolski", (51.9181, 17.2406) },
                { "Zielona Wieś", (51.9544, 17.2761) },
                { "Jeżewo", (51.9822, 17.1950) },
                { "Skoki", (51.9683, 17.1606) },
                { "Karolew", (51.9944, 17.1303) },
                { "Kowalew", (51.9250, 17.0944) },
                { "Szymanowo", (52.0225, 17.1011) },
                { "Dolsk", (51.9817, 17.0642) },
                { "Księginki", (51.9550, 16.9817) },
                { "Drożki", (51.9989, 16.9431) },
                { "Mchy", (51.9519, 16.9097) },
                { "Błażejewo", (51.9200, 16.9317) },
                { "Ostrowieczno", (51.8953, 16.9669) },
                { "Bruszczewo", (51.8761, 16.9097) },
                { "Gądki", (52.0681, 16.9950) },
                { "Kokoszczyn", (52.1050, 16.9789) },
                { "Czmoń", (52.0503, 16.9311) },
                { "Boguszyn", (52.0047, 16.8669) },
                { "Kiączyn", (52.0231, 16.7989) },
                { "Racot", (51.9392, 16.7997) },
                { "Rogaczewo Wielkie", (51.9114, 16.7756) },
                { "Jabłonna", (51.9456, 16.7150) },
                { "Stare Bojanowo", (51.7067, 16.5936) },
                { "Śmigiel", (52.0142, 16.5261) },
                { "Broników", (52.0528, 16.5242) },
                { "Koszanowo", (52.0817, 16.5261) },
                { "Sierpowo", (52.0906, 16.4714) },
                { "Wielichowo", (52.1147, 16.3575) },
                { "Łubnica", (52.1392, 16.4194) },
                { "Duszniki", (52.1500, 16.4150) },
                { "Sękowo", (52.1700, 16.5150) },
                { "Chrzypsko Wielkie", (52.1719, 16.2444) },
                { "Pniewy", (52.5094, 16.2564) },
                { "Lwówek", (52.4478, 16.1794) },
                { "Kuślin", (52.4761, 16.0878) },
                { "Wytomyśl", (52.3658, 16.0561) },
                { "Bukowiec", (52.3356, 16.0033) },
                { "Opalenica", (52.3078, 16.4127) },
                { "Wojnowice", (52.3281, 16.4772) },
                { "Porażyn", (52.3619, 16.4233) },
                { "Łomnica", (52.3883, 16.3814) },
                { "Urbanowo", (52.4147, 16.3917) },
                { "Sędzinko", (52.3550, 16.3450) },
                { "Dakowy Mokre", (52.3167, 16.3106) },
                { "Rudniki", (52.2792, 16.3450) },
                { "Niegolewo", (52.3117, 16.2714) },
                { "Jastrzębniki", (52.3269, 16.1950) },
                { "Pamiątkowo", (52.3850, 16.2550) },
                { "Ziemin", (52.4011, 16.3078) },
                { "Chełmno", (52.4308, 16.3756) },
                { "Szamotuły", (52.6120, 16.5779) },
                { "Baborówko", (52.5983, 16.6522) },
                { "Baborowo", (52.6272, 16.6650) },
                { "Pamiątkowo", (52.6456, 16.6086) },
                { "Piotrkówko", (52.6667, 16.5681) },
                { "Otorowo", (52.6856, 16.5506) },
                { "Mrowino", (52.5556, 16.6325) },
                { "Cerekwica", (52.5194, 16.6817) },
                { "Przecław", (52.5017, 16.7133) },
                { "Lusówko", (52.4461, 16.7403) },
                { "Lusowo", (52.4419, 16.7061) },
                { "Sady", (52.4764, 16.6564) },
                { "Baranowo", (52.5033, 16.6147) },
                { "Jankowice", (52.4847, 16.5731) },
                { "Góra", (52.4525, 16.5381) },
                { "Kokoszczyn", (52.4181, 16.5792) },
                { "Wysogotowo", (52.3933, 16.6472) },
                { "Przeźmierowo", (52.4178, 16.6667) },
                { "Jelonek", (52.3792, 16.7289) },
                { "Bytkowo", (52.3342, 16.7408) },
                { "Daszewice", (52.3164, 16.6756) },
                { "Rożnowo", (52.3436, 16.6289) },
                { "Skórzewo", (52.3544, 16.6861) },
                { "Palędzie", (52.3725, 16.6328) },
                { "Więckowice", (52.3917, 16.5897) },
                { "Złotniki", (52.3486, 16.5592) },
                { "Chyby", (52.3803, 16.5206) },
                { "Sobota", (52.3961, 16.4789) },
                { "Napachanie", (52.4519, 16.5019) },
                { "Rokietnica", (52.5075, 16.7407) },
                { "Mrowino", (52.5228, 16.7550) },
                { "Cerekwica", (52.5436, 16.7208) },
                { "Przybroda", (52.5667, 16.7217) },
                { "Rostworowo", (52.5508, 16.7747) },
                { "Krzyszkowo", (52.5350, 16.8206) },
                { "Kobylniki", (52.5139, 16.7967) },
                { "Żydowo", (52.5825, 16.7942) },
                { "Kiekrz", (52.4536, 16.7744) },
                { "Pawłowice", (52.4717, 16.7975) },
                { "Regiewo", (52.4897, 16.8308) },
                { "Złotkowo", (52.4744, 16.8683) },
                { "Golęczewo", (52.5025, 16.8633) },
                { "Dębogóra", (52.5244, 16.8392) },
                { "Dębogorze", (52.5219, 16.8650) },
                { "Kamionki", (52.5322, 16.8967) },
                { "Psarskie", (52.5650, 16.9258) },
                { "Radojewo", (52.5839, 16.9514) },
                { "Biedrusko", (52.4994, 16.9089) },
                { "Chludowo", (52.5147, 16.9358) },
                { "Zielątkowo", (52.5392, 16.9617) },
                { "Bolechowo", (52.5550, 17.0050) },
                { "Trzek", (52.5556, 17.0447) },
                { "Potasze", (52.5744, 17.0708) },
                { "Czachurki", (52.5853, 17.1072) },
                { "Długa Goślina", (52.5956, 17.1339) },
                { "Wojnówko", (52.5739, 17.1642) },
                { "Wojnowo", (52.5911, 17.1889) },
                { "Łopuchowo", (52.5561, 17.1603) },
                { "Łopuchówko", (52.5386, 17.1594) },
                { "Przebędowo", (52.5619, 17.1278) },
                { "Starczanowo", (52.5819, 17.0886) },
                { "Głęboczek", (52.6011, 17.0711) },
                { "Głębocko", (52.6153, 17.0422) },
                { "Boduszewo", (52.6350, 17.0139) },
                { "Nieszawa", (52.6567, 16.9869) },
                { "Sława Wielkopolska", (52.6733, 16.9556) },
                { "Uchorowo", (52.6006, 16.9456) },
                { "Białężyn", (52.5728, 16.8950) },
                { "Trojanowo", (52.5969, 16.8683) },
                { "Radzim", (52.6186, 16.8389) },
                { "Karłowice", (52.5831, 16.8128) },
                { "Rakownia", (52.5611, 16.8397) },
                { "Kamińsko", (52.5406, 16.8022) },
                { "Gołaszewo", (52.5178, 16.7553) },
                { "Bogucin", (52.5414, 17.0228) },
                { "Kowanówko", (52.5592, 16.7400) },
                { "Pomarzanowice", (52.5117, 17.0714) },
                { "Pławno", (52.4850, 17.0997) },
                { "Garby", (52.4431, 17.1089) },
                { "Uzarzewo", (52.4522, 17.1508) },
                { "Biskupice", (52.4894, 17.1447) },
                { "Jerzykowo", (52.4769, 17.1819) },
                { "Wierzenica", (52.5086, 17.1933) },
                { "Kobylnica", (52.4550, 17.2067) },
                { "Bogucin", (52.4350, 17.1742) },
                { "Gruszczyn", (52.4092, 17.1189) },
                { "Katarzynki", (52.3886, 17.1336) },
                { "Janikowo", (52.3719, 17.1378) },
                { "Zalasewo", (52.4122, 17.0564) },
                { "Gortatowo", (52.3997, 17.0136) },
                { "Kórnik", (52.2471, 17.0895) },
                { "Borówiec", (52.2756, 17.0694) },
                { "Szczodrzykowo", (52.2711, 17.0256) },
                { "Gądki", (52.2939, 17.0092) },
                { "Jaryszki", (52.3136, 17.0100) },
                { "Szczytniki", (52.2561, 16.9847) },
                { "Koninko", (52.2250, 17.0294) },
                { "Czołowo", (52.2108, 17.0669) },
                { "Mieczewo", (52.2264, 17.1244) },
                { "Radzewo", (52.2494, 17.1622) },
                { "Bnin", (52.2300, 17.1144) },
                { "Błażejewo", (52.2103, 17.1722) },
                { "Czmoń", (52.1972, 17.1497) },
                { "Prusinowo", (52.1825, 17.1103) },
                { "Pierzchno", (52.1694, 17.0803) },
                { "Robakowo", (52.1897, 17.0503) },
                { "Dziećmierowo", (52.2061, 17.0044) },
                { "Skrzynki", (52.2356, 16.9664) },
                { "Dachowa", (52.2142, 16.9361) },
                { "Kamionki", (52.1897, 16.9681) },
                { "Błażejewko", (52.1694, 16.9975) },
                { "Trzykolne Młyny", (52.1486, 17.0244) },
                { "Runowo", (52.1328, 17.0569) },
                { "Konarskie", (52.1108, 17.0856) },
                { "Biernatki", (52.1389, 17.1222) },
                { "Daszewice", (52.1719, 17.1569) },
                { "Robczysko", (52.1922, 17.2022) },
                { "Grzymysław", (52.1703, 17.2231) },
                { "Turew", (52.0442, 17.0731) },
                { "Rąbiń", (52.0672, 17.0983) },
                { "Krajkowo", (52.1006, 17.0328) },
                { "Rogalin", (52.2350, 16.9311) },
                { "Rogalinek", (52.2483, 16.9025) },
                { "Świątniki", (52.2283, 16.8831) },
                { "Mieczewo", (52.2108, 16.9033) },
                { "Sasinowo", (52.1897, 16.9244) },
                { "Wiórek", (52.1778, 16.8906) },
                { "Radzewice", (52.1503, 16.8719) },
                { "Głuchowo", (52.1333, 16.9025) },
                { "Chomęcice", (52.1172, 16.9311) },
                { "Krosno", (52.0978, 16.9531) },
                { "Żabno", (52.1508, 16.8250) },
                { "Czapury", (52.2961, 16.9436) },
                { "Grzebienisko", (52.3081, 16.9647) },
                { "Wiry", (52.3228, 16.9206) },
                { "Dębiec", (52.3428, 16.8983) },
                { "Babki", (52.3136, 16.8719) },
                { "Gołuski", (52.2869, 16.8531) },
                { "Kołtunin", (52.2678, 16.8372) },
                { "Krosinko", (52.2456, 16.8633) },
                { "Baranowo", (52.2267, 16.8397) },
                { "Kamionki", (52.2058, 16.8128) },
                { "Niepruszewo", (52.1844, 16.8328) },
                { "Komorniki", (52.3378, 16.8117) },
                { "Rosnówko", (52.3203, 16.7922) },
                { "Walerianowo", (52.3031, 16.7725) },
                { "Łęczyca", (52.3219, 16.7397) },
                { "Plewiska", (52.3678, 16.8133) },
                { "Szreniawa", (52.3169, 16.8436) },
                { "Głuchowo", (52.3519, 16.8619) },
                { "Chomęcice", (52.3728, 16.8389) },
                { "Komorniki", (52.3378, 16.8117) },
                { "Wiry", (52.3228, 16.9206) },
                { "Łęczyca", (52.0597, 19.1997) },
                
                // Inne większe miasta
                { "Kraków", (50.064650, 19.944980) },
                { "Wrocław", (51.107885, 17.038538) },
                { "Gdańsk", (54.352025, 18.646638) },
                { "Szczecin", (53.428543, 14.552812) },
                { "Bydgoszcz", (53.123482, 18.008438) },
                { "Lublin", (51.246454, 22.568446) },
                { "Katowice", (50.264892, 19.023782) },
                { "Białystok", (53.132489, 23.164099) },
                { "Gdynia", (54.518889, 18.531944) },
                { "Częstochowa", (50.811944, 19.120278) },
                { "Sosnowiec", (50.286389, 19.104444) },
                { "Toruń", (53.013790, 18.598444) },
                { "Kielce", (50.866077, 20.628568) },
                { "Rzeszów", (50.041187, 21.999121) },
                { "Gliwice", (50.294444, 18.671389) },
                { "Zabrze", (50.307778, 18.785556) },
                { "Olsztyn", (53.770226, 20.490189) },
                { "Bytom", (50.348056, 18.916111) },
                { "Zielona Góra", (51.935619, 15.506186) },
                { "Rybnik", (50.097222, 18.541667) },
                { "Ruda Śląska", (50.255833, 18.855556) },
                { "Tychy", (50.130556, 18.966667) },
                { "Opole", (50.671062, 17.926126) },
                { "Gorzów Wielkopolski", (52.736892, 15.228758) },
                { "Dąbrowa Górnicza", (50.333333, 19.183333) },
                { "Elbląg", (54.152222, 19.404722) },
                { "Płock", (52.546389, 19.706389) },
                { "Wałbrzych", (50.771667, 16.284167) },
                { "Włocławek", (52.648333, 19.067222) },
                { "Tarnów", (50.013056, 20.988889) },
                { "Chorzów", (50.297222, 18.954444) },
                { "Koszalin", (54.193889, 16.171667) },
                { "Legnica", (51.207222, 16.155278) },
                { "Grudziądz", (53.483611, 18.756667) },
                { "Jaworzno", (50.205000, 19.272500) },
                { "Słupsk", (54.464167, 17.028611) },
                { "Jastrzębie-Zdrój", (49.955278, 18.610278) },
                { "Nowy Sącz", (49.617222, 20.715000) },
                { "Jelenia Góra", (50.899444, 15.729167) },
                { "Siedlce", (52.167222, 22.290000) },
                { "Mysłowice", (50.208056, 19.166389) },
                { "Konin", (52.223056, 18.251111) },
                { "Piła", (53.151111, 16.738167) },
                { "Piotrków Trybunalski", (51.405278, 19.703056) },
                { "Ostrów Wielkopolski", (51.655000, 17.806944) },
                { "Inowrocław", (52.799444, 18.263889) },
                { "Suwałki", (54.111389, 22.930833) },
                { "Stargard", (53.336389, 15.050556) },
                { "Gniezno", (52.534861, 17.582694) },
                { "Głogów", (51.663889, 16.084722) },
                { "Siemianowice Śląskie", (50.326389, 19.029722) },
                { "Pabianice", (51.664722, 19.354722) },
                { "Chełm", (51.143333, 23.471667) },
                { "Tomaszów Mazowiecki", (51.531111, 20.008611) },
                { "Zamość", (50.723056, 23.251944) },
                { "Stalowa Wola", (50.582222, 22.053333) },
                { "Kędzierzyn-Koźle", (50.350000, 18.200000) },
                { "Przemyśl", (49.783889, 22.767222) },
                { "Łomża", (53.178056, 22.059167) },
                { "Mielec", (50.287222, 21.423889) },
                { "Żory", (50.044722, 18.700556) },
                { "Tarnowskie Góry", (50.445833, 18.861111) },
                { "Tczew", (54.092500, 18.777778) },
                { "Bielsko-Biała", (49.822500, 19.058611) },
                { "Zgierz", (51.855556, 19.406389) },
                { "Biała Podlaska", (52.032222, 23.116667) },
                { "Świdnica", (50.848889, 16.475000) },
                { "Będzin", (50.326111, 19.125556) },
                { "Piekary Śląskie", (50.383333, 18.933333) },
                { "Racibórz", (50.091944, 18.219444) },
                { "Legionowo", (52.401667, 20.926667) },
                { "Oświęcim", (50.034444, 19.238056) },
                { "Zawiercie", (50.487778, 19.416667) },
                { "Puławy", (51.416667, 21.966667) },
                { "Wejherowo", (54.605556, 18.235833) },
                { "Starachowice", (51.037222, 21.071111) },
                { "Ostrowiec Świętokrzyski", (50.929444, 21.385556) },
                { "Sanok", (49.555556, 22.205556) },
                { "Knurów", (50.218889, 18.672222) },
                { "Skarżysko-Kamienna", (51.113056, 20.871667) },
                { "Ciechanów", (52.881389, 20.619722) },
                { "Krosno", (49.688889, 21.770833) },
                { "Żyrardów", (52.048889, 20.445556) },
                { "Mikołów", (50.173611, 18.901389) },
                { "Rumia", (54.570833, 18.388056) },
                { "Ostrołęka", (53.086944, 21.569000) },
                { "Świętochłowice", (50.296389, 18.923611) },
                { "Nowa Sól", (51.803333, 15.716667) },
                { "Kutno", (52.230833, 19.361389) },
                { "Szczecinek", (53.710278, 16.699167) },
                { "Bolesławiec", (51.264444, 15.583333) },
                { "Mińsk Mazowiecki", (52.179167, 21.572222) },
                { "Kołobrzeg", (54.176111, 15.576389) },
                { "Pruszków", (52.170833, 20.812500) },
                { "Żywiec", (49.685000, 19.192500) },
                { "Sopot", (54.441389, 18.560000) },
                { "Piaseczno", (52.081389, 21.024722) },
                { "Dzierżoniów", (50.728056, 16.651389) },
                { "Oława", (50.946389, 17.292500) },
                { "Nowy Dwór Mazowiecki", (52.430000, 20.716667) },
                { "Zakopane", (49.299167, 19.949167) },
                { "Wołomin", (52.340000, 21.241944) },
                { "Sochaczew", (52.229167, 20.238056) },
                { "Świnoujście", (53.910278, 14.247222) },
                { "Jarosław", (50.016389, 22.677778) },
                { "Jasło", (49.745000, 21.472500) },
                { "Wodzisław Śląski", (50.000000, 18.466667) },
                { "Żagań", (51.617500, 15.314722) },
                { "Kraśnik", (50.923889, 22.226944) },
                { "Nysa", (50.474167, 17.334444) },
                { "Zduńska Wola", (51.598889, 18.939722) },
                { "Lębork", (54.539167, 17.749444) },
                { "Kobyłka", (52.339444, 21.195000) },
                { "Cieszyn", (49.749444, 18.632778) },
                { "Police", (53.551944, 14.571944) },
                { "Czechowice-Dziedzice", (49.914167, 19.003611) },
                { "Ząbki", (52.293056, 21.105278) },
                { "Brzeg", (50.860833, 17.469722) },
                { "Czerwionka-Leszczyny", (50.148889, 18.678611) },
                { "Kozienice", (51.582778, 21.547778) },
                { "Iława", (53.595833, 19.568889) },
                { "Zgorzelec", (51.149444, 15.008333) },
                { "Dębica", (50.051389, 21.411944) },
                { "Świecie", (53.463333, 18.446389) },
                { "Pułtusk", (52.701667, 21.086111) },
                { "Wyszków", (52.593056, 21.458056) },
                { "Lubin", (51.398889, 16.201944) },
                { "Giżycko", (54.038056, 21.775000) },
                { "Września", (52.325278, 17.565278) },
                { "Łowicz", (52.107222, 19.945278) },
                { "Oleśnica", (51.210000, 17.386389) },
                { "Brodnica", (53.257500, 19.395833) },
                { "Marki", (52.321111, 21.105000) },
                { "Gorlice", (49.655556, 21.159722) },
                { "Kłodzko", (50.434722, 16.661111) },
                { "Grodzisk Mazowiecki", (52.106389, 20.633611) },
                { "Wałcz", (53.283889, 16.465000) },
                { "Pszczyna", (49.978056, 18.942500) },
                { "Kętrzyn", (54.075833, 21.375278) },
{ "Bielawa", (50.690556, 16.623056) },
                { "Bartoszyce", (54.253611, 20.808056) },
                { "Śrem", (52.088611, 17.015000) },
                { "Goleniów", (53.563889, 14.828611) },
                { "Piastów", (52.183333, 20.837222) },
                { "Otwock", (52.105556, 21.261111) },
                { "Lubartów", (51.460278, 22.608889) },
                { "Łaziska Górne", (50.149167, 18.841667) },
                { "Konstantynów Łódzki", (51.747778, 19.325556) },
                { "Złotów", (53.359444, 17.040722) },
                { "Pyskowice", (50.391944, 18.630833) },
                { "Rydułtowy", (50.058889, 18.418333) },
                { "Gryfino", (53.252500, 14.488056) },
                { "Augustów", (53.843333, 22.979722) },
                { "Bochnia", (49.968889, 20.430278) },
                { "Ostróda", (53.696389, 19.964722) },
                { "Lubliniec", (50.668889, 18.683333) },
                { "Nowy Tomyśl", (52.319722, 16.128333) },
                { "Kościerzyna", (54.122222, 17.981111) },
                { "Chrzanów", (50.135556, 19.402222) },
                { "Szczytno", (53.562500, 20.988333) },
                { "Radlin", (50.048611, 18.476389) },
                { "Piotrków Kujawski", (52.550000, 18.503056) }
            };
        }

        public async Task<(double lat, double lng)?> GeocodeAddressAsync(string address)
        {
            if (string.IsNullOrWhiteSpace(address))
                return null;

            try
            {
                // Metoda 1: Spróbuj znaleźć miejscowość w lokalnym słowniku
                var localResult = TryGeocodeLocally(address);
                if (localResult.HasValue)
                {
                    System.Diagnostics.Debug.WriteLine($"Znaleziono lokalnie: {address} -> {localResult.Value.lat}, {localResult.Value.lng}");
                    return localResult;
                }

                // Metoda 2: Użyj Nominatim
                var nominatimResult = await TryNominatimGeocoding(address);
                if (nominatimResult.HasValue)
                {
                    System.Diagnostics.Debug.WriteLine($"Nominatim: {address} -> {nominatimResult.Value.lat}, {nominatimResult.Value.lng}");
                    return nominatimResult;
                }

                // Metoda 3: Spróbuj z samą miejscowością
                var cityOnly = ExtractCity(address);
                if (!string.IsNullOrEmpty(cityOnly))
                {
                    var cityResult = await TryNominatimGeocoding(cityOnly + ", Polska");
                    if (cityResult.HasValue)
                    {
                        System.Diagnostics.Debug.WriteLine($"Nominatim (miasto): {cityOnly} -> {cityResult.Value.lat}, {cityResult.Value.lng}");
                        return cityResult;
                    }
                }

                System.Diagnostics.Debug.WriteLine($"Nie znaleziono: {address}");
                return null;
            }
            catch (Exception ex)
            {
                System.Diagnostics.Debug.WriteLine($"Błąd geokodowania dla '{address}': {ex.Message}");
                return null;
            }
        }

        private (double lat, double lng)? TryGeocodeLocally(string address)
        {
            if (string.IsNullOrWhiteSpace(address))
                return null;

            // Normalizuj adres
            address = address.ToLowerInvariant();

            foreach (var city in fallbackCoordinates)
            {
                string cityName = city.Key.ToLowerInvariant();

                // Sprawdź dokładne dopasowanie lub czy adres zawiera nazwę miasta
                if (address.Contains(cityName))
                {
                    // Dodaj małe losowe przesunięcie, żeby markery nie nakładały się dokładnie
                    var random = new Random(address.GetHashCode());
                    double latOffset = (random.NextDouble() - 0.5) * 0.005; // ~500m
                    double lngOffset = (random.NextDouble() - 0.5) * 0.005;

                    return (city.Value.lat + latOffset, city.Value.lng + lngOffset);
                }
            }

            return null;
        }

        private async Task<(double lat, double lng)?> TryNominatimGeocoding(string address)
        {
            try
            {
                string cleanAddress = CleanAddress(address);

                var queryParams = new Dictionary<string, string>
                {
                    { "q", cleanAddress },
                    { "format", "json" },
                    { "limit", "1" },
                    { "countrycodes", "pl" },
                    { "addressdetails", "1" },
                    { "accept-language", "pl" }
                };

                var queryString = string.Join("&", queryParams.Select(kvp =>
                    $"{kvp.Key}={Uri.EscapeDataString(kvp.Value)}"));

                var url = $"https://nominatim.openstreetmap.org/search?{queryString}";

                System.Diagnostics.Debug.WriteLine($"Nominatim URL: {url}");

                var response = await httpClient.GetStringAsync(url);
                dynamic results = JsonConvert.DeserializeObject(response);

                if (results != null && results.Count > 0)
                {
                    string latStr = results[0].lat?.ToString();
                    string lngStr = results[0].lon?.ToString();

                    if (!string.IsNullOrEmpty(latStr) && !string.IsNullOrEmpty(lngStr))
                    {
                        if (double.TryParse(latStr, NumberStyles.Float, CultureInfo.InvariantCulture, out double lat) &&
                            double.TryParse(lngStr, NumberStyles.Float, CultureInfo.InvariantCulture, out double lng))
                        {
                            return (lat, lng);
                        }
                    }
                }
            }
            catch (HttpRequestException httpEx)
            {
                System.Diagnostics.Debug.WriteLine($"HTTP Error: {httpEx.Message}");
            }
            catch (TaskCanceledException)
            {
                System.Diagnostics.Debug.WriteLine("Request timeout");
            }
            catch (Exception ex)
            {
                System.Diagnostics.Debug.WriteLine($"Nominatim error: {ex.Message}");
            }

            return null;
        }

        private string CleanAddress(string address)
        {
            if (string.IsNullOrWhiteSpace(address))
                return string.Empty;

            // Usuń niepotrzebne znaki specjalne ale zachowaj polskie znaki
            address = Regex.Replace(address, @"[^\w\s,.\-ąćęłńóśźżĄĆĘŁŃÓŚŹŻ]", " ", RegexOptions.IgnoreCase);
            address = Regex.Replace(address, @"\s+", " ");

            // Sprawdź czy adres ma strukturę
            bool hasStreet = Regex.IsMatch(address, @"(ul\.|ulica|al\.|aleja|pl\.|plac|os\.|osiedle)", RegexOptions.IgnoreCase);
            bool hasNumber = Regex.IsMatch(address, @"\d+");
            bool hasCity = address.Split(',').Length > 1 || Regex.IsMatch(address, @"\d{2}-\d{3}");

            // Jeśli adres jest niepełny, spróbuj go uzupełnić
            if (!hasCity)
            {
                // Sprawdź kod pocztowy
                var kodMatch = Regex.Match(address, @"(\d{2})-(\d{3})");
                if (kodMatch.Success)
                {
                    string kod = kodMatch.Value;
                    string kodPrefix = kod.Substring(0, 2);

                    // Mapowanie kodów pocztowych na miasta
                    switch (kodPrefix)
                    {
                        case "90":
                        case "91":
                        case "92":
                        case "93":
                        case "94":
                            if (!address.Contains("Łódź"))
                                address += ", Łódź";
                            break;
                        case "95":
                            if (!address.Contains("Pabianice") && !address.Contains("Zgierz"))
                                address += ", okolice Łodzi";
                            break;
                        case "96":
                            if (!address.Contains("Skierniewice") && !address.Contains("Rawa Mazowiecka"))
                                address += ", województwo łódzkie";
                            break;
                        case "97":
                            if (!address.Contains("Bełchatów") && !address.Contains("Piotrków"))
                                address += ", województwo łódzkie";
                            break;
                        case "98":
                            if (!address.Contains("Sieradz") && !address.Contains("Wieluń"))
                                address += ", województwo łódzkie";
                            break;
                        case "99":
                            if (!address.Contains("Łowicz") && !address.Contains("Kutno"))
                                address += ", województwo łódzkie";
                            break;
                        case "00":
                        case "01":
                        case "02":
                        case "03":
                        case "04":
                        case "05":
                            if (!address.Contains("Warszawa"))
                                address += ", Warszawa";
                            break;
                        case "26":
                            if (!address.Contains("Radom"))
                                address += ", okolice Radomia";
                            break;
                        case "09":
                            if (!address.Contains("Płock"))
                                address += ", okolice Płocka";
                            break;
                        case "62":
                            if (!address.Contains("Konin") && !address.Contains("Turek"))
                                address += ", województwo wielkopolskie";
                            break;
                        case "60":
                        case "61":
                            if (!address.Contains("Poznań"))
                                address += ", Poznań";
                            break;
                    }
                }

                // Jeśli wciąż nie ma miasta i nie ma Polski, dodaj Polska
                if (!address.Contains("Polska") && !address.Contains("Poland") &&
                    !address.Contains("województwo") && !address.Contains("okolice"))
                {
                    address += ", Polska";
                }
            }

            // Usuń podwójne przecinki i spacje
            address = Regex.Replace(address, @",\s*,", ",");
            address = Regex.Replace(address, @"\s+", " ");

            return address.Trim();
        }

        private string ExtractCity(string address)
        {
            if (string.IsNullOrWhiteSpace(address))
                return string.Empty;

            // Usuń kod pocztowy jeśli jest
            address = Regex.Replace(address, @"\d{2}-\d{3}", "").Trim();

            var parts = address.Split(',');

            // Szukaj części która wygląda jak miasto (ostatnia część zazwyczaj)
            for (int i = parts.Length - 1; i >= 0; i--)
            {
                var part = parts[i].Trim();

                // Pomiń jeśli to tylko liczby lub "Polska"
                if (Regex.IsMatch(part, @"^\d+$") ||
                    part.Equals("Polska", StringComparison.OrdinalIgnoreCase) ||
                    part.Equals("Poland", StringComparison.OrdinalIgnoreCase))
                    continue;

                // Usuń prefiks ulicy jeśli jest
                part = Regex.Replace(part, @"^(ul\.|ulica|al\.|aleja|pl\.|plac|os\.|osiedle)\s+", "",
                    RegexOptions.IgnoreCase).Trim();

                // Jeśli to nie jest pusta wartość, zwróć jako miasto
                if (!string.IsNullOrWhiteSpace(part) && !Regex.IsMatch(part, @"^\d"))
                {
                    return part;
                }
            }

            // Jeśli nie znaleziono miasta, spróbuj wziąć pierwszą część która nie jest ulicą
            foreach (var part in parts)
            {
                var trimmed = part.Trim();
                if (!Regex.IsMatch(trimmed, @"(ul\.|ulica|al\.|aleja|pl\.|plac)", RegexOptions.IgnoreCase) &&
                    !Regex.IsMatch(trimmed, @"^\d+") &&
                    !string.IsNullOrWhiteSpace(trimmed))
                {
                    return trimmed;
                }
            }

            return string.Empty;
        }

        public (double lat, double lng) GetFallbackCoordinates(string address)
        {
            // Najpierw spróbuj znaleźć w lokalnej bazie
            var result = TryGeocodeLocally(address);
            if (result.HasValue)
                return result.Value;

            // Jeśli nie znaleziono, zwróć losowe współrzędne w Polsce
            var random = new Random(address?.GetHashCode() ?? 0);

            // Centrum Polski z losowym przesunięciem
            double lat = 52.0 + (random.NextDouble() - 0.5) * 3; // 50.5 - 53.5
            double lng = 19.0 + (random.NextDouble() - 0.5) * 4; // 17 - 21

            return (lat, lng);
        }
    }
}